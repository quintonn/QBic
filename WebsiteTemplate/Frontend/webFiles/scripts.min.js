;
var auth={doLogin:function(){var n=document.getElementById("txtName").value,t=document.getElementById("txtPassword").value,i=main.webApiURL+"token",r="grant_type=password&username="+n+"&password="+t+"&client_id="+main.applicationName;main.makeWebCall(i,"POST",auth.onLoginSuccess,r)},onLoginSuccess:function(n){console.log("login success: "+n);auth.refreshTokenResponse(n);menuBuilder.clearNode("loginContainer");main.init()},makeRefreshCall:function(){var n=auth.getRefreshToken(),t;console.log(n);t="grant_type=refresh_token&client_id="+main.applicationName+"&refresh_token="+n;main.makeWebCall(main.webApiURL+"token","POST",auth.refreshTokenResponse,t)},getRefreshToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.refresh_token!=null&&(t=n.refresh_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},getAccessToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.access_token!=null&&(t=n.access_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},refreshTokenResponse:function(n){var t=n.access_token,i=n.userName;localStorage.setItem(main.tokenName,JSON.stringify(n));auth.startRefreshTimer()},startRefreshTimer:function(){var n=localStorage.getItem(main.tokenName),t;n=JSON.parse(n);t=n[".expires"];t=new Date(t);var i=Math.abs(new Date-t)-5e3,r=i,u=n.refresh_token;setTimeout(auth.refreshTokenHandler,r)},refreshTokenHandler:function(){auth.makeRefreshCall()},clearRefreshTokenHandler:function(){clearTimeout(auth.refreshTokenHandler)},logout:function(){auth.clearRefreshTokenHandler();navigation.clearSettings();main.init()}};
var inputDialog={loadInputPage:function(n,t){menuBuilder.clearNode("dlgInput");document.getElementById("inputContent").style.display="inline";t=t||function(){};var i=function(){t()};navigation.loadHtmlBody("dlgInput",n,i)},cancelInput:function(){document.getElementById("inputContent").style.display="none";menuBuilder.clearNode("dlgInput")},addHiddenField:function(n,t){var r=document.getElementById("dlgInput"),i=document.createElement("input");i.type="hidden";i.value=t;i.id=n;r.appendChild(i)},getHiddenField:function(n){var t=document.getElementById(n);return t==null?"":t.value},cancelMessage:function(){document.getElementById("messageContent").style.display="none";menuBuilder.clearNode("dlgMessage")},showMessage:function(n,t,i){menuBuilder.clearNode("dlgMessage");var r=n.ConfirmationMessage;r==null&&(r=n);r=r||"";r=r.toString().replace(/\n/g,"<br/>");document.getElementById("messageContent").style.display="inline";navigation.loadHtmlBody("dlgMessage","MessageDialog.html",function(){var v=document.getElementById("msgPageTitle"),f,e,c,l,a,u;v.innerHTML="Message";var s=document.getElementById("msgTable"),h=document.createElement("tr"),o=document.createElement("td");o.colSpan=2;o.innerHTML=r;o.style.textAlign="center";h.appendChild(o);s.appendChild(h);f=document.createElement("tr");e=!1;n.ConfirmationButtonText!=null&&n.ConfirmationButtonText.length>0&&(c=function(){n.OnConfirmationUIAction>0&&siteMenu.executeUIAction(n.OnConfirmationUIAction,i);t!=null&&t()},u=inputDialog.createInputDialogButton(n.ConfirmationButtonText,c),f.appendChild(u),e=!0);n.CancelButtonText!=null&&n.CancelButtonText.length>0&&(l=function(){n.OnCancelUIAction>0&&siteMenu.executeUIAction(n.OnCancelUIAction,i);t!=null&&e==!1&&t()},u=inputDialog.createInputDialogButton(n.CancelButtonText,l),f.appendChild(u),e=!0);e==!1&&(a=function(){inputDialog.cancelInput();t!=null&&t()},u=inputDialog.createInputDialogButton("Ok",a),f.appendChild(u));s.appendChild(f)})},createInputDialogButton:function(n,t){var r=document.createElement("td"),i;return r.style.textAlign="center",i=document.createElement("button"),i.innerHTML=n,i.onclick=function(){inputDialog.cancelMessage();t&&t()},r.appendChild(i),r}};
var main={applicationName:"websiteTemplate",baseURL:"",webApiURL:"api/v1/",menuApiUrl:"",tokenNameSuffix:"UserToken",tokenName:"",userSettingSuffix:"UserSetting",userSettingName:"",version:"0.0.3",scriptLoaded:!1,bodyOnLoad:function(){main.baseURL="https://"+window.location.host+window.location.pathname;main.init()},init:function(){var t,n,i;menuBuilder.clearMenu();document.title=main.applicationName;main.tokenName=main.applicationName+"_"+main.tokenNameSuffix+"_"+main.version;main.userSettingName=main.applicationName+"_"+main.userSettingSuffix+"_"+main.version;main.menuApiUrl=main.webApiURL+"menu/";t=navigation.getParameterByName("confirmed");t!=null&&t.length>0&&(inputDialog.showMessage("Email for "+t+" successfully confirmed.\nYou can now log in with the credentials for "+t),n=window.location.href,i=n.lastIndexOf("?"),n=n.substring(0,i),window.history.pushState(n,main.applicationName,n));main.makeWebCall(main.webApiURL+"initialize","GET",main.processInitResponse)},processInitResponse:function(n){var t=n;document.getElementById("aUserName").innerHTML=t.User;navigation.entryPoint(t);auth.startRefreshTimer()},makeWebCall:function(n,t,i,r,u){var f,e;main.showBusyIndicator1();t=t||"GET";f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){main.processWebRequest(f,i,u)};n=main.baseURL+n;f.open(t,n,!0);e=auth.getAccessToken();f.setRequestHeader("Authorization","Bearer "+e);f.send(r)},processWebRequest:function(n,t,i){var e,u,r,o,f;if(n.readyState===4){main.hideBusyIndicator();switch(n.status){case 200:u=n.getResponseHeader("content-type");u=u||"";e=n.responseText;u.indexOf("application/json")>-1&&(e=JSON.parse(e));t(e,i);break;case 400:if(u=n.getResponseHeader("content-type"),u=u||"",r=n.response,u.indexOf("application/json")>-1&&(r=JSON.parse(r)),r&&r.error&&r.error_description)switch(r.error){case"invalid_grant":o=document.getElementById("loginErrorMessage");o==null&&(inputDialog.showMessage("Not on login page. But expected to be on login page"),main.init());o.innerHTML=r.error_description;break;default:inputDialog.showMessage("unknown error description: "+r.error_description)}else inputDialog.showMessage(r.Message);break;case 401:navigation.showLoginPage();break;case 403:inputDialog.showMessage("You are not authorized to perform the requested action.\n"+n.statusText);break;case 500:f=JSON.parse(n.response);f=f.ExceptionMessage||f;inputDialog.showMessage("Internal Server Error:\n"+f);break;default:menuBuilder.clearNode("menuContainer");menuBuilder.clearNode("userDetail");navigation.loadHtmlBodyResponse(n.response,"mainContent")}}},showBusyIndicator1:function(){var n=document.getElementById("busyContainer");n.style.visibility="visible"},hideBusyIndicator:function(){var n=document.getElementById("busyContainer");n.style.visibility="hidden"}};
var menuBuilder={buildMenu:function(n){menuBuilder.clearMenu();document.getElementById("userDetail").style.display="inline";navigation.loadHtmlBody("menuContainer","Menu.html",function(){menuBuilder.clearNode("menuDiv");siteMenu.buildMenu(n)})},addMenuButton:function(n,t){var u=document.getElementById("menuDiv"),i=menuBuilder.createMenuButton(n),r=function(){i.disabled=!1},f=function(){i.disabled=!0;try{t.length>0?t(r):(t(),r())}catch(n){console.log(n+"\n"+n.stack)}};i.onclick=f;u.appendChild(i)},createMenuButton:function(n){var t=document.createElement("button");return t.innerHTML=n,t},clearMenu:function(){menuBuilder.clearNode("menuContainer");document.getElementById("loginContainer").style.visibility="hidden";document.getElementById("userDetail").style.display="none"},clearNode:function(n){for(var t=document.getElementById(n);t.firstChild;)t.removeChild(t.firstChild)}};
var navigation={entryPoint:function(){navigation.loadHtmlBody("mainContent","Home.html");navigation.getUserMenu()},getUserMenu:function(){main.makeWebCall(main.webApiURL+"getUserMenu","GET",navigation.processUserMenuResponse)},processUserMenuResponse:function(n){var t=n;menuBuilder.buildMenu(t)},clearSettings:function(){localStorage.removeItem(main.tokenName);localStorage.removeItem(main.userSettingName)},showLoginPage:function(){menuBuilder.clearMenu();navigation.loadHtmlBody("loginContainer","Login.html",navigation.loadLoginPageCompleted)},loadLoginPageCompleted:function(){document.getElementById("txtName").onkeypress=function(n){n.keyCode==13&&document.getElementById("txtPassword").focus()};document.getElementById("txtPassword").onkeypress=function(n){n.keyCode==13&&auth.doLogin()};document.getElementById("loginContainer").style.visibility="visible";document.getElementById("txtName").focus()},loadHtmlBody:function(n,t,i){var r="/frontend/pages/"+t+"?v="+main.version,u=function(n,t){navigation.loadHtmlBodyResponse(n,t);i&&i()};main.makeWebCall(r,"GET",u,null,n)},loadHtmlBodyResponse:function(n,t){var i=document.getElementById(t);i.innerHTML=n},getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}};
var siteMenu={buildMenu:function(n){var t;menuBuilder.addMenuButton("Home",function(){navigation.entryPoint()});for(t in n){var i=t,r=n[t],u=function(n){return function(){siteMenu.executeUIAction(n)}}(i);menuBuilder.addMenuButton(r,u)}},processEvent:function(n,t,i,r){var u={Data:t||"",ActionId:i};u=JSON.stringify(u);main.makeWebCall(main.webApiURL+"processEvent/"+n,"POST",siteMenu.processUIActionResponse,u,r)},executeUIAction:function(n,t){var i={Data:t||""};i=JSON.stringify(i);main.makeWebCall(main.webApiURL+"executeUIAction/"+n,"POST",siteMenu.processUIActionResponse,i,t)},processUIActionResponse:function(n,t){var f=n[0],i,r,u,e,o;n.splice(0,1);i=function(){};n.length>0&&(i=function(n){return function(){siteMenu.processUIActionResponse(n,t)}}(n));r=f;u=-1;r!=null&&r.ActionType!=null&&(u=r.ActionType);e=f;switch(u){case-1:inputDialog.showMessage(e,i,null);break;case 0:o=f.ViewData;siteMenu.populateView(o,r,null,t);i();break;case 1:siteMenu.buildInput(r,t);i();break;case 4:inputDialog.cancelInput();i();break;case 5:inputDialog.showMessage(e,i,r.Data);break;case 6:siteMenu.executeUIAction(r.EventNumber,r.ParametersToPass);i();break;default:inputDialog.showMessage("unknown action type: "+u,i,null)}},buildInput:function(n,t){inputDialog.loadInputPage("InputDialog.html",function(){var ii=document.getElementById("pageTitle"),wt,lt,bt,b,e,i,y,d,s,f,o,u,c,dt,at,l,a,tt,it,h,vt,yt,rt,gt,ut,p,ft,ni,et,ot,st,ei,w,r,pt,k;ii.innerHTML=n.Description;var ht=document.getElementById("inputTable"),v=[],ct=function(n){for(var i,t=0;t<v.length;t++)if(i=v[t],i.TriggerInputName==n)return!0;return!1};for(r=0;r<n.InputFields.length;r++)if(i=n.InputFields[r],i.VisibilityConditions!=null&&i.VisibilityConditions.length>0)for(wt=i.InputName,s=0;s<i.VisibilityConditions.length;s++)lt=i.VisibilityConditions[s],bt={InputName:wt,Condition:lt,TriggerInputName:lt.ColumnName},v.push(bt);for(b=function(n,t){var r=n.value,u,i,e,f,n;for(n.type=="checkbox"&&(r=n.checked),r=r+"",u=0;u<v.length;u++)if(i=v[u],i.TriggerInputName==t){for(e="_"+i.InputName,f=!0,i.Condition.Comparison==0?f=r===i.Condition.ColumnValue:i.Condition.Comparison==1?f=r!=i.Condition.ColumnValue:alert("Unknown comparison "+i.Condition.Comparison),n=document.getElementById(e);n.tagName!="TR";)n=n.parentNode;n.style.display=f?"":"none"}},r=0;r<n.InputFields.length;r++){e=document.createElement("tr");v.push(r);i=n.InputFields[r];switch(i.InputType){case 0:case 1:u=document.createElement("td");u.innerHTML=i.InputLabel;e.appendChild(u);f=document.createElement("input");f.type=i.InputType==1?"password":"text";f.id="_"+i.InputName;i.DefaultValue!=null&&i.DefaultValue.length>0&&(f.value=i.DefaultValue);ct(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));o=document.createElement("td");o.appendChild(f);e.appendChild(o);break;case 2:inputDialog.addHiddenField("_"+i.InputName,i.DefaultValue);break;case 3:for(u=document.createElement("td"),u.innerHTML=i.InputLabel,e.appendChild(u),y=document.createElement("select"),ct(i.InputName)&&(y.onchange=function(n){return function(){b(this,n)}}(i.InputName)),y.id="_"+i.InputName,d=i.ListItems,s=0;s<d.length;s++)h=document.createElement("option"),h.value=d[s],h.text=d[s],y.appendChild(h);i.DefaultValue!=null&&i.DefaultValue.length>0&&(y.value=i.DefaultValue);o=document.createElement("td");o.appendChild(y);e.appendChild(o);break;case 4:u=document.createElement("td");u.innerHTML=i.InputLabel;e.appendChild(u);f=document.createElement("input");ct(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));f.type="checkbox";f.id="_"+i.InputName;i.DefaultValue!=null&&(f.checked=i.DefaultValue);o=document.createElement("td");o.appendChild(f);e.appendChild(o);break;case 5:u=document.createElement("td");u.innerHTML=i.InputLabel;e.appendChild(u);ht.appendChild(e);e=document.createElement("tr");c=document.createElement("table");c.style.fontSize="75%";c.frame="box";c.cellPadding="0";c.style.padding="0";var g=document.createElement("tr"),nt=document.createElement("tr"),ri=document.createElement("tr"),ui=document.createElement("tr"),kt=document.createElement("td");for(kt.innerHTML=i.SelectedItemsLabel,dt=document.createElement("td"),at=document.createElement("td"),at.innerHTML=i.AvailableItemsLabel,g.appendChild(kt),g.appendChild(dt),g.appendChild(at),l=document.createElement("select"),l.multiple=!0,l.id="_"+i.InputName+"_1",l.size=5,l.style.width="100%",a=document.createElement("select"),a.multiple=!0,a.id="_"+i.InputName+"_2",a.size=5,a.style.width="100%",tt=0;tt<i.ListSource.length;tt++){for(it=i.ListSource[tt],h=document.createElement("option"),h.value=it.Key,h.text=it.Value,vt=!1,yt=i.DefaultValue||[],rt=0;rt<yt.length;rt++)if(gt=yt[rt],gt==it.Key){vt=!0;break}vt?l.appendChild(h):a.appendChild(h)}ut=document.createElement("td");ut.rowSpan=3;ut.appendChild(l);nt.appendChild(ut);p=document.createElement("td");p.rowSpan=3;ft=document.createElement("button");ft.innerHTML="<<";ft.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",f=document.getElementById(r),i=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);p.appendChild(ft);ni=document.createElement("br");p.appendChild(ni);et=document.createElement("button");et.innerHTML=">>";et.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",i=document.getElementById(r),f=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);p.appendChild(et);nt.appendChild(p);ot=document.createElement("td");ot.rowSpan=3;ot.appendChild(a);nt.appendChild(ot);c.appendChild(g);c.appendChild(nt);c.appendChild(ri);c.appendChild(ui);st=document.createElement("td");st.colSpan=3;st.appendChild(c);e.appendChild(st);break;default:inputDialog.showMessage("Unknown input type: "+i.InputType);continue}ht.appendChild(e)}for(r=0;r<n.InputFields.length;r++){var i=n.InputFields[r],fi="_"+i.InputName,ti=document.getElementById(fi);ti!=null&&b(ti,i.InputName)}for(ei=document.createElement("tr"),w=document.createElement("td"),w.colSpan=2,r=0;r<n.InputButtons.length;r++)pt=n.InputButtons[r],k=document.createElement("button"),k.style.margin="10px",k.innerHTML=pt.Label,k.onclick=function(i,r){return function(){for(var c={},f,u,e,h,s,o=0;o<r.InputFields.length;o++){if(f=r.InputFields[o],f.InputType==5)for(e=[],u=document.getElementById("_"+f.InputName+"_1"),h=u.options,s=0;s<h.length;s++)e.push(h[s].value);else{if(u=document.getElementById("_"+f.InputName),u==null)continue;e=u.value;u.type=="checkbox"&&(e=u.checked)}c[f.InputName]=e}t!=null&&t.length>0;siteMenu.processEvent(n.Id,c,i,t)}}(pt.ActionNumber,n),w.appendChild(k);w.style.textAlign="center";w.style.verticalAlign="middle";ht.appendChild(w)})},populateView:function(n,t,i){navigation.loadHtmlBody("mainContent","Views.html",function(){var it=views.getTable(),l=document.createElement("tr"),ot=document.getElementById("viewsTitle"),w,e,s,b,rt,a,v,c,y,nt,ft,u,tt,o,et;for(ot.innerHTML=t.Description,e=0;e<t.Columns.length;e++)w=document.createElement("th"),w.innerHTML=t.Columns[e].ColumnLabel,l.appendChild(w);for(it.appendChild(l),u=0;u<n.length;u++){for(l=document.createElement("tr"),e=0;e<t.Columns.length;e++){var r=t.Columns[e],h=document.createElement("td"),f="";if(r.ColumnName!=null&&r.ColumnName.length>0){for(f=n[u],s=r.ColumnName;s.indexOf(".")>-1;)b=s.indexOf("."),rt=s.substring(0,b),f=f[rt],s=s.substring(b+1);f=f[s]}if(r.ColumnType==1?(f==!0?f=r.TrueValueDisplay:f==!1&&(f=r.FalseValueDisplay),h.innerHTML=f):r.ColumnType==2?(o=document.createElement("button"),o.onclick=function(i,r){return function(){var o=n[i].Id,f=JSON.stringify(n[i]),u=t.Columns[r],e;u.Event.ActionType==5?inputDialog.showMessage(u.Event,null,f):u.Event.ActionType==6?(e=u.Event.EventNumber,f=n[i].Id,siteMenu.executeUIAction(e,f)):inputDialog.showMessage("Unknown action type "+u.Event.ActionType)}}(u,e),r.ButtonTextSource==0?o.innerHTML=r.ButtonText:(inputDialog.showMessage("Unhandled ButtonTextSource: "+r.ButtonTextSource),o.innerHTML="????"),h.appendChild(o)):r.ColumnType==3?(a=document.createElement("a"),a.href="#",a.innerHTML=r.LinkLabel,a.onclick=function(t,i){return function(){var r={Id:n[i][t.KeyColumn]},u=t.EventNumber;siteMenu.executeUIAction(u,r)}}(r,u),h.appendChild(a)):h.innerHTML=f,r.ColumnSetting!=null&&r.ColumnSetting.ColumnSettingType==0){for(v=r.ColumnSetting.Display==0,c=!0,y=0;y<r.ColumnSetting.Conditions.length;y++){var k=r.ColumnSetting.Conditions[y],s=k.ColumnName,d=k.Comparison,ut=k.ColumnValue,p=n[u][s]||"";p=p.toString();d==0?c=c&&p==ut:d==1?c=c&&p!=ut:alert("Unknown comparison: "+d)}if(c==!1&&v==!0||c==!0&&v==!1){var v=r.ColumnSetting.Display==0,st=h.innerHTML,g=document.createElement("div");g.innerHTML=st;nt=document.createElement("td");nt.appendChild(g);g.style.display="none";h=nt}}l.appendChild(h)}it.appendChild(l)}for(ft=document.getElementById("viewsMenu"),menuBuilder.clearNode("viewsMenu"),u=0;u<t.ViewMenu.length;u++)tt=t.ViewMenu[u],o=document.createElement("button"),o.innerHTML=tt.Label,o.onclick=function(n,i){return function(){var r=t.ViewMenu[i];siteMenu.executeUIAction(n,r.ParametersToPass)}}(tt.EventNumber,u),ft.appendChild(o);et=document.getElementById("viewsFooter");et.innerHTML=t.ViewMessage!=null&&t.ViewMessage.length>0?t.ViewMessage:"";i&&i()})}};
var views={getTable:function(){return document.getElementById("tblView")}};
var auth={doLogin:function(){var n=document.getElementById("txtName").value,t=document.getElementById("txtPassword").value,i=main.webApiURL+"token",r="grant_type=password&username="+n+"&password="+t+"&client_id="+main.applicationName;main.makeWebCall(i,"POST",auth.onLoginSuccess,r)},onLoginSuccess:function(n){console.log("login success: "+n);auth.refreshTokenResponse(n);menuBuilder.clearNode("loginContainer");main.init()},makeRefreshCall:function(){var n=auth.getRefreshToken(),t;console.log(n);t="grant_type=refresh_token&client_id="+main.applicationName+"&refresh_token="+n;main.makeWebCall(main.webApiURL+"token","POST",auth.refreshTokenResponse,t)},getRefreshToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.refresh_token!=null&&(t=n.refresh_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},getAccessToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.access_token!=null&&(t=n.access_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},refreshTokenResponse:function(n){var t=n.access_token,i=n.userName;localStorage.setItem(main.tokenName,JSON.stringify(n));auth.startRefreshTimer()},startRefreshTimer:function(){var n=localStorage.getItem(main.tokenName),t;n=JSON.parse(n);t=n[".expires"];t=new Date(t);var i=Math.abs(new Date-t)-5e3,r=i,u=n.refresh_token;setTimeout(auth.refreshTokenHandler,r)},refreshTokenHandler:function(){auth.makeRefreshCall()},clearRefreshTokenHandler:function(){clearTimeout(auth.refreshTokenHandler)},logout:function(){auth.clearRefreshTokenHandler();navigation.clearSettings();main.init()}},inputDialog={loadInputPage:function(n,t){menuBuilder.clearNode("dlgInput");document.getElementById("inputContent").style.display="inline";t=t||function(){};var i=function(){t()};navigation.loadHtmlBody("dlgInput",n,i)},cancelInput:function(){document.getElementById("inputContent").style.display="none";menuBuilder.clearNode("dlgInput")},addHiddenField:function(n,t){var r=document.getElementById("dlgInput"),i=document.createElement("input");i.type="hidden";i.value=t;i.id=n;r.appendChild(i)},getHiddenField:function(n){var t=document.getElementById(n);return t==null?"":t.value},cancelMessage:function(){document.getElementById("messageContent").style.display="none";menuBuilder.clearNode("dlgMessage")},showMessage:function(n,t,i){menuBuilder.clearNode("dlgMessage");var r=n.ConfirmationMessage;r==null&&(r=n);r=r||"";r=r.toString().replace(/\n/g,"<br/>");document.getElementById("messageContent").style.display="inline";navigation.loadHtmlBody("dlgMessage","MessageDialog.html",function(){var v=document.getElementById("msgPageTitle"),f,e,s,h,c,u;v.innerHTML="Message";var l=document.getElementById("msgTable"),a=document.createElement("tr"),o=document.createElement("td");o.colSpan=2;o.innerHTML=r;o.style.textAlign="center";a.appendChild(o);l.appendChild(a);f=document.createElement("tr");e=!1;n.ConfirmationButtonText!=null&&n.ConfirmationButtonText.length>0&&(s=function(){n.OnConfirmationUIAction>0&&siteMenu.executeUIAction(n.OnConfirmationUIAction,i);t!=null&&t()},u=inputDialog.createInputDialogButton(n.ConfirmationButtonText,s),f.appendChild(u),e=!0);n.CancelButtonText!=null&&n.CancelButtonText.length>0&&(h=function(){n.OnCancelUIAction>0&&siteMenu.executeUIAction(n.OnCancelUIAction,i);t!=null&&e==!1&&t()},u=inputDialog.createInputDialogButton(n.CancelButtonText,h),f.appendChild(u),e=!0);e==!1&&(c=function(){inputDialog.cancelInput();t!=null&&t()},u=inputDialog.createInputDialogButton("Ok",c),f.appendChild(u));l.appendChild(f)})},createInputDialogButton:function(n,t){var r=document.createElement("td"),i;return r.style.textAlign="center",i=document.createElement("button"),i.innerHTML=n,i.onclick=function(){inputDialog.cancelMessage();t&&t()},r.appendChild(i),r}},main={applicationName:"websiteTemplate",baseURL:"",webApiURL:"api/v1/",menuApiUrl:"",tokenNameSuffix:"UserToken",tokenName:"",userSettingSuffix:"UserSetting",userSettingName:"",version:"0.0.3",scriptLoaded:!1,bodyOnLoad:function(){main.baseURL="https://"+window.location.host+window.location.pathname;main.init()},init:function(){var t,n,i;menuBuilder.clearMenu();document.title=main.applicationName;main.tokenName=main.applicationName+"_"+main.tokenNameSuffix+"_"+main.version;main.userSettingName=main.applicationName+"_"+main.userSettingSuffix+"_"+main.version;main.menuApiUrl=main.webApiURL+"menu/";t=navigation.getParameterByName("confirmed");t!=null&&t.length>0&&(inputDialog.showMessage("Email for "+t+" successfully confirmed.\nYou can now log in with the credentials for "+t),n=window.location.href,i=n.lastIndexOf("?"),n=n.substring(0,i),window.history.pushState(n,main.applicationName,n));main.makeWebCall(main.webApiURL+"initialize","GET",main.processInitResponse)},processInitResponse:function(n){var t=n;document.getElementById("aUserName").innerHTML=t.User;navigation.entryPoint(t);auth.startRefreshTimer()},makeWebCall:function(n,t,i,r,u){var f,e;main.showBusyIndicator1();t=t||"GET";f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){main.processWebRequest(f,i,u)};n=main.baseURL+n;f.open(t,n,!0);e=auth.getAccessToken();f.setRequestHeader("Authorization","Bearer "+e);f.send(r)},processWebRequest:function(n,t,i){var e,u,r,o,f;if(n.readyState===4){main.hideBusyIndicator();switch(n.status){case 200:u=n.getResponseHeader("content-type");u=u||"";e=n.responseText;u.indexOf("application/json")>-1&&(e=JSON.parse(e));t(e,i);break;case 400:if(u=n.getResponseHeader("content-type"),u=u||"",r=n.response,u.indexOf("application/json")>-1&&(r=JSON.parse(r)),r&&r.error&&r.error_description)switch(r.error){case"invalid_grant":o=document.getElementById("loginErrorMessage");o==null&&(inputDialog.showMessage("Not on login page. But expected to be on login page"),main.init());o.innerHTML=r.error_description;break;default:inputDialog.showMessage("unknown error description: "+r.error_description)}else inputDialog.showMessage(r.Message);break;case 401:navigation.showLoginPage();break;case 403:inputDialog.showMessage("You are not authorized to perform the requested action.\n"+n.statusText);break;case 500:f=JSON.parse(n.response);f=f.ExceptionMessage||f;inputDialog.showMessage("Internal Server Error:\n"+f);break;default:menuBuilder.clearNode("menuContainer");menuBuilder.clearNode("userDetail");navigation.loadHtmlBodyResponse(n.response,"mainContent")}}},showBusyIndicator1:function(){var n=document.getElementById("busyContainer");n.style.visibility="visible"},hideBusyIndicator:function(){var n=document.getElementById("busyContainer");n.style.visibility="hidden"}},menuBuilder={buildMenu:function(n){menuBuilder.clearMenu();document.getElementById("userDetail").style.display="inline";navigation.loadHtmlBody("menuContainer","Menu.html",function(){menuBuilder.clearNode("menuDiv");siteMenu.buildMenu(n)})},addMenuButton:function(n,t){var u=document.getElementById("menuDiv"),i=menuBuilder.createMenuButton(n),r=function(){i.disabled=!1},f=function(){i.disabled=!0;try{t.length>0?t(r):(t(),r())}catch(n){console.log(n+"\n"+n.stack)}};i.onclick=f;u.appendChild(i)},createMenuButton:function(n){var t=document.createElement("button");return t.innerHTML=n,t},clearMenu:function(){menuBuilder.clearNode("menuContainer");document.getElementById("loginContainer").style.visibility="hidden";document.getElementById("userDetail").style.display="none"},clearNode:function(n){for(var t=document.getElementById(n);t.firstChild;)t.removeChild(t.firstChild)}},navigation={entryPoint:function(){navigation.loadHtmlBody("mainContent","Home.html");navigation.getUserMenu()},getUserMenu:function(){main.makeWebCall(main.webApiURL+"getUserMenu","GET",navigation.processUserMenuResponse)},processUserMenuResponse:function(n){var t=n;menuBuilder.buildMenu(t)},clearSettings:function(){localStorage.removeItem(main.tokenName);localStorage.removeItem(main.userSettingName)},showLoginPage:function(){menuBuilder.clearMenu();navigation.loadHtmlBody("loginContainer","Login.html",navigation.loadLoginPageCompleted)},loadLoginPageCompleted:function(){document.getElementById("txtName").onkeypress=function(n){n.keyCode==13&&document.getElementById("txtPassword").focus()};document.getElementById("txtPassword").onkeypress=function(n){n.keyCode==13&&auth.doLogin()};document.getElementById("loginContainer").style.visibility="visible";document.getElementById("txtName").focus()},loadHtmlBody:function(n,t,i){var r="/frontend/pages/"+t+"?v="+main.version,u=function(n,t){navigation.loadHtmlBodyResponse(n,t);i&&i()};main.makeWebCall(r,"GET",u,null,n)},loadHtmlBodyResponse:function(n,t){var i=document.getElementById(t);i.innerHTML=n},getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}},siteMenu={buildMenu:function(n){var t;menuBuilder.addMenuButton("Home",function(){navigation.entryPoint()});for(t in n){var i=t,r=n[t],u=function(n){return function(){siteMenu.executeUIAction(n)}}(i);menuBuilder.addMenuButton(r,u)}},processEvent:function(n,t,i,r){var u={Data:t||"",ActionId:i};u=JSON.stringify(u);main.makeWebCall(main.webApiURL+"processEvent/"+n,"POST",siteMenu.processUIActionResponse,u,r)},executeUIAction:function(n,t){var i={Data:t||""};i=JSON.stringify(i);main.makeWebCall(main.webApiURL+"executeUIAction/"+n,"POST",siteMenu.processUIActionResponse,i,t)},processUIActionResponse:function(n,t){var f=n[0],i,r,u,e,o;n.splice(0,1);i=function(){};n.length>0&&(i=function(n){return function(){siteMenu.processUIActionResponse(n,t)}}(n));r=f;u=-1;r!=null&&r.ActionType!=null&&(u=r.ActionType);e=f;switch(u){case-1:inputDialog.showMessage(e,i,null);break;case 0:o=f.ViewData;siteMenu.populateView(o,r,null,t);i();break;case 1:siteMenu.buildInput(r,t);i();break;case 4:inputDialog.cancelInput();i();break;case 5:inputDialog.showMessage(e,i,r.Data);break;case 6:siteMenu.executeUIAction(r.EventNumber,r.ParametersToPass);i();break;default:inputDialog.showMessage("unknown action type: "+u,i,null)}},buildInput:function(n,t){inputDialog.loadInputPage("InputDialog.html",function(){var ii=document.getElementById("pageTitle"),wt,ht,bt,b,u,i,v,d,s,f,h,e,o,kt,ct,l,a,g,nt,c,lt,at,tt,dt,it,y,rt,gt,ut,ft,et,ri,p,r,vt,k;ii.innerHTML=n.Description;var yt=document.getElementById("inputTable"),w=[],pt=function(n){for(var i,t=0;t<w.length;t++)if(i=w[t],i.TriggerInputName==n)return!0;return!1};for(r=0;r<n.InputFields.length;r++)if(i=n.InputFields[r],i.VisibilityConditions!=null&&i.VisibilityConditions.length>0)for(wt=i.InputName,s=0;s<i.VisibilityConditions.length;s++)ht=i.VisibilityConditions[s],bt={InputName:wt,Condition:ht,TriggerInputName:ht.ColumnName},w.push(bt);for(b=function(n,t){var r=n.value,u,i,e,f,n;for(n.type=="checkbox"&&(r=n.checked),r=r+"",u=0;u<w.length;u++)if(i=w[u],i.TriggerInputName==t){for(e="_"+i.InputName,f=!0,i.Condition.Comparison==0?f=r===i.Condition.ColumnValue:i.Condition.Comparison==1?f=r!=i.Condition.ColumnValue:alert("Unknown comparison "+i.Condition.Comparison),n=document.getElementById(e);n.tagName!="TR";)n=n.parentNode;n.style.display=f?"":"none"}},r=0;r<n.InputFields.length;r++){u=document.createElement("tr");w.push(r);i=n.InputFields[r];switch(i.InputType){case 0:case 1:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");f.type=i.InputType==1?"password":"text";f.id="_"+i.InputName;i.DefaultValue!=null&&i.DefaultValue.length>0&&(f.value=i.DefaultValue);pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 2:inputDialog.addHiddenField("_"+i.InputName,i.DefaultValue);break;case 3:for(e=document.createElement("td"),e.innerHTML=i.InputLabel,u.appendChild(e),v=document.createElement("select"),pt(i.InputName)&&(v.onchange=function(n){return function(){b(this,n)}}(i.InputName)),v.id="_"+i.InputName,d=i.ListItems,s=0;s<d.length;s++)c=document.createElement("option"),c.value=d[s],c.text=d[s],v.appendChild(c);i.DefaultValue!=null&&i.DefaultValue.length>0&&(v.value=i.DefaultValue);h=document.createElement("td");h.appendChild(v);u.appendChild(h);break;case 4:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));f.type="checkbox";f.id="_"+i.InputName;i.DefaultValue!=null&&(f.checked=i.DefaultValue);h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 5:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);yt.appendChild(u);u=document.createElement("tr");o=document.createElement("table");o.style.fontSize="75%";o.frame="box";o.cellPadding="0";o.style.padding="0";var ot=document.createElement("tr"),st=document.createElement("tr"),ui=document.createElement("tr"),fi=document.createElement("tr"),ni=document.createElement("td");for(ni.innerHTML=i.SelectedItemsLabel,kt=document.createElement("td"),ct=document.createElement("td"),ct.innerHTML=i.AvailableItemsLabel,ot.appendChild(ni),ot.appendChild(kt),ot.appendChild(ct),l=document.createElement("select"),l.multiple=!0,l.id="_"+i.InputName+"_1",l.size=5,l.style.width="100%",a=document.createElement("select"),a.multiple=!0,a.id="_"+i.InputName+"_2",a.size=5,a.style.width="100%",g=0;g<i.ListSource.length;g++){for(nt=i.ListSource[g],c=document.createElement("option"),c.value=nt.Key,c.text=nt.Value,lt=!1,at=i.DefaultValue||[],tt=0;tt<at.length;tt++)if(dt=at[tt],dt==nt.Key){lt=!0;break}lt?l.appendChild(c):a.appendChild(c)}it=document.createElement("td");it.rowSpan=3;it.appendChild(l);st.appendChild(it);y=document.createElement("td");y.rowSpan=3;rt=document.createElement("button");rt.innerHTML="<<";rt.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",f=document.getElementById(r),i=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(rt);gt=document.createElement("br");y.appendChild(gt);ut=document.createElement("button");ut.innerHTML=">>";ut.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",i=document.getElementById(r),f=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(ut);st.appendChild(y);ft=document.createElement("td");ft.rowSpan=3;ft.appendChild(a);st.appendChild(ft);o.appendChild(ot);o.appendChild(st);o.appendChild(ui);o.appendChild(fi);et=document.createElement("td");et.colSpan=3;et.appendChild(o);u.appendChild(et);break;default:inputDialog.showMessage("Unknown input type: "+i.InputType);continue}yt.appendChild(u)}for(r=0;r<n.InputFields.length;r++){var i=n.InputFields[r],ei="_"+i.InputName,ti=document.getElementById(ei);ti!=null&&b(ti,i.InputName)}for(ri=document.createElement("tr"),p=document.createElement("td"),p.colSpan=2,r=0;r<n.InputButtons.length;r++)vt=n.InputButtons[r],k=document.createElement("button"),k.style.margin="10px",k.innerHTML=vt.Label,k.onclick=function(i,r){return function(){for(var c={},f,u,e,s,o,h=0;h<r.InputFields.length;h++){if(f=r.InputFields[h],f.InputType==5)for(e=[],u=document.getElementById("_"+f.InputName+"_1"),s=u.options,o=0;o<s.length;o++)e.push(s[o].value);else{if(u=document.getElementById("_"+f.InputName),u==null)continue;e=u.value;u.type=="checkbox"&&(e=u.checked)}c[f.InputName]=e}t!=null&&t.length>0;siteMenu.processEvent(n.Id,c,i,t)}}(vt.ActionNumber,n),p.appendChild(k);p.style.textAlign="center";p.style.verticalAlign="middle";yt.appendChild(p)})},populateView:function(n,t,i){navigation.loadHtmlBody("mainContent","Views.html",function(){var it=views.getTable(),l=document.createElement("tr"),ot=document.getElementById("viewsTitle"),w,e,o,b,rt,a,v,h,y,k,ut,u,d,s,ft;for(ot.innerHTML=t.Description,e=0;e<t.Columns.length;e++)w=document.createElement("th"),w.innerHTML=t.Columns[e].ColumnLabel,l.appendChild(w);for(it.appendChild(l),u=0;u<n.length;u++){for(l=document.createElement("tr"),e=0;e<t.Columns.length;e++){var r=t.Columns[e],c=document.createElement("td"),f="";if(r.ColumnName!=null&&r.ColumnName.length>0){for(f=n[u],o=r.ColumnName;o.indexOf(".")>-1;)b=o.indexOf("."),rt=o.substring(0,b),f=f[rt],o=o.substring(b+1);f=f[o]}if(r.ColumnType==1?(f==!0?f=r.TrueValueDisplay:f==!1&&(f=r.FalseValueDisplay),c.innerHTML=f):r.ColumnType==2?(s=document.createElement("button"),s.onclick=function(i,r){return function(){var o=n[i].Id,f=JSON.stringify(n[i]),u=t.Columns[r],e;u.Event.ActionType==5?inputDialog.showMessage(u.Event,null,f):u.Event.ActionType==6?(e=u.Event.EventNumber,f=n[i].Id,siteMenu.executeUIAction(e,f)):inputDialog.showMessage("Unknown action type "+u.Event.ActionType)}}(u,e),r.ButtonTextSource==0?s.innerHTML=r.ButtonText:(inputDialog.showMessage("Unhandled ButtonTextSource: "+r.ButtonTextSource),s.innerHTML="????"),c.appendChild(s)):r.ColumnType==3?(a=document.createElement("a"),a.href="#",a.innerHTML=r.LinkLabel,a.onclick=function(t,i){return function(){var r={Id:n[i][t.KeyColumn]},u=t.EventNumber;siteMenu.executeUIAction(u,r)}}(r,u),c.appendChild(a)):c.innerHTML=f,r.ColumnSetting!=null&&r.ColumnSetting.ColumnSettingType==0){for(v=r.ColumnSetting.Display==0,h=!0,y=0;y<r.ColumnSetting.Conditions.length;y++){var g=r.ColumnSetting.Conditions[y],o=g.ColumnName,nt=g.Comparison,et=g.ColumnValue,p=n[u][o]||"";p=p.toString();nt==0?h=h&&p==et:nt==1?h=h&&p!=et:alert("Unknown comparison: "+nt)}if(h==!1&&v==!0||h==!0&&v==!1){var v=r.ColumnSetting.Display==0,st=c.innerHTML,tt=document.createElement("div");tt.innerHTML=st;k=document.createElement("td");k.appendChild(tt);tt.style.display="none";c=k}}l.appendChild(c)}it.appendChild(l)}for(ut=document.getElementById("viewsMenu"),menuBuilder.clearNode("viewsMenu"),u=0;u<t.ViewMenu.length;u++)d=t.ViewMenu[u],s=document.createElement("button"),s.innerHTML=d.Label,s.onclick=function(n,i){return function(){var r=t.ViewMenu[i];siteMenu.executeUIAction(n,r.ParametersToPass)}}(d.EventNumber,u),ut.appendChild(s);ft=document.getElementById("viewsFooter");ft.innerHTML=t.ViewMessage!=null&&t.ViewMessage.length>0?t.ViewMessage:"";i&&i()})}},views={getTable:function(){return document.getElementById("tblView")}},auth={doLogin:function(){var n=document.getElementById("txtName").value,t=document.getElementById("txtPassword").value,i=main.webApiURL+"token",r="grant_type=password&username="+n+"&password="+t+"&client_id="+main.applicationName;main.makeWebCall(i,"POST",auth.onLoginSuccess,r)},onLoginSuccess:function(n){console.log("login success: "+n);auth.refreshTokenResponse(n);menuBuilder.clearNode("loginContainer");main.init()},makeRefreshCall:function(){var n=auth.getRefreshToken(),t;console.log(n);t="grant_type=refresh_token&client_id="+main.applicationName+"&refresh_token="+n;main.makeWebCall(main.webApiURL+"token","POST",auth.refreshTokenResponse,t)},getRefreshToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.refresh_token!=null&&(t=n.refresh_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},getAccessToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.access_token!=null&&(t=n.access_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},refreshTokenResponse:function(n){var t=n.access_token,i=n.userName;localStorage.setItem(main.tokenName,JSON.stringify(n));auth.startRefreshTimer()},startRefreshTimer:function(){var n=localStorage.getItem(main.tokenName),t;n=JSON.parse(n);t=n[".expires"];t=new Date(t);var i=Math.abs(new Date-t)-5e3,r=i,u=n.refresh_token;setTimeout(auth.refreshTokenHandler,r)},refreshTokenHandler:function(){auth.makeRefreshCall()},clearRefreshTokenHandler:function(){clearTimeout(auth.refreshTokenHandler)},logout:function(){auth.clearRefreshTokenHandler();navigation.clearSettings();main.init()}},inputDialog={loadInputPage:function(n,t){menuBuilder.clearNode("dlgInput");document.getElementById("inputContent").style.display="inline";t=t||function(){};var i=function(){t()};navigation.loadHtmlBody("dlgInput",n,i)},cancelInput:function(){document.getElementById("inputContent").style.display="none";menuBuilder.clearNode("dlgInput")},addHiddenField:function(n,t){var r=document.getElementById("dlgInput"),i=document.createElement("input");i.type="hidden";i.value=t;i.id=n;r.appendChild(i)},getHiddenField:function(n){var t=document.getElementById(n);return t==null?"":t.value},cancelMessage:function(){document.getElementById("messageContent").style.display="none";menuBuilder.clearNode("dlgMessage")},showMessage:function(n,t,i){menuBuilder.clearNode("dlgMessage");var r=n.ConfirmationMessage;r==null&&(r=n);r=r||"";r=r.toString().replace(/\n/g,"<br/>");document.getElementById("messageContent").style.display="inline";navigation.loadHtmlBody("dlgMessage","MessageDialog.html",function(){var v=document.getElementById("msgPageTitle"),f,e,s,h,c,u;v.innerHTML="Message";var l=document.getElementById("msgTable"),a=document.createElement("tr"),o=document.createElement("td");o.colSpan=2;o.innerHTML=r;o.style.textAlign="center";a.appendChild(o);l.appendChild(a);f=document.createElement("tr");e=!1;n.ConfirmationButtonText!=null&&n.ConfirmationButtonText.length>0&&(s=function(){n.OnConfirmationUIAction>0&&siteMenu.executeUIAction(n.OnConfirmationUIAction,i);t!=null&&t()},u=inputDialog.createInputDialogButton(n.ConfirmationButtonText,s),f.appendChild(u),e=!0);n.CancelButtonText!=null&&n.CancelButtonText.length>0&&(h=function(){n.OnCancelUIAction>0&&siteMenu.executeUIAction(n.OnCancelUIAction,i);t!=null&&e==!1&&t()},u=inputDialog.createInputDialogButton(n.CancelButtonText,h),f.appendChild(u),e=!0);e==!1&&(c=function(){inputDialog.cancelInput();t!=null&&t()},u=inputDialog.createInputDialogButton("Ok",c),f.appendChild(u));l.appendChild(f)})},createInputDialogButton:function(n,t){var r=document.createElement("td"),i;return r.style.textAlign="center",i=document.createElement("button"),i.innerHTML=n,i.onclick=function(){inputDialog.cancelMessage();t&&t()},r.appendChild(i),r}},main={applicationName:"websiteTemplate",baseURL:"",webApiURL:"api/v1/",menuApiUrl:"",tokenNameSuffix:"UserToken",tokenName:"",userSettingSuffix:"UserSetting",userSettingName:"",version:"0.0.3",scriptLoaded:!1,bodyOnLoad:function(){main.baseURL="https://"+window.location.host+window.location.pathname;main.init()},init:function(){var t,n,i;menuBuilder.clearMenu();document.title=main.applicationName;main.tokenName=main.applicationName+"_"+main.tokenNameSuffix+"_"+main.version;main.userSettingName=main.applicationName+"_"+main.userSettingSuffix+"_"+main.version;main.menuApiUrl=main.webApiURL+"menu/";t=navigation.getParameterByName("confirmed");t!=null&&t.length>0&&(inputDialog.showMessage("Email for "+t+" successfully confirmed.\nYou can now log in with the credentials for "+t),n=window.location.href,i=n.lastIndexOf("?"),n=n.substring(0,i),window.history.pushState(n,main.applicationName,n));main.makeWebCall(main.webApiURL+"initialize","GET",main.processInitResponse)},processInitResponse:function(n){var t=n;document.getElementById("aUserName").innerHTML=t.User;navigation.entryPoint(t);auth.startRefreshTimer()},makeWebCall:function(n,t,i,r,u){var f,e;main.showBusyIndicator1();t=t||"GET";f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){main.processWebRequest(f,i,u)};n=main.baseURL+n;f.open(t,n,!0);e=auth.getAccessToken();f.setRequestHeader("Authorization","Bearer "+e);f.send(r)},processWebRequest:function(n,t,i){var e,u,r,o,f;if(n.readyState===4){main.hideBusyIndicator();switch(n.status){case 200:u=n.getResponseHeader("content-type");u=u||"";e=n.responseText;u.indexOf("application/json")>-1&&(e=JSON.parse(e));t(e,i);break;case 400:if(u=n.getResponseHeader("content-type"),u=u||"",r=n.response,u.indexOf("application/json")>-1&&(r=JSON.parse(r)),r&&r.error&&r.error_description)switch(r.error){case"invalid_grant":o=document.getElementById("loginErrorMessage");o==null&&(inputDialog.showMessage("Not on login page. But expected to be on login page"),main.init());o.innerHTML=r.error_description;break;default:inputDialog.showMessage("unknown error description: "+r.error_description)}else inputDialog.showMessage(r.Message);break;case 401:navigation.showLoginPage();break;case 403:inputDialog.showMessage("You are not authorized to perform the requested action.\n"+n.statusText);break;case 500:f=JSON.parse(n.response);f=f.ExceptionMessage||f;inputDialog.showMessage("Internal Server Error:\n"+f);break;default:menuBuilder.clearNode("menuContainer");menuBuilder.clearNode("userDetail");navigation.loadHtmlBodyResponse(n.response,"mainContent")}}},showBusyIndicator1:function(){var n=document.getElementById("busyContainer");n.style.visibility="visible"},hideBusyIndicator:function(){var n=document.getElementById("busyContainer");n.style.visibility="hidden"}},menuBuilder={buildMenu:function(n){menuBuilder.clearMenu();document.getElementById("userDetail").style.display="inline";navigation.loadHtmlBody("menuContainer","Menu.html",function(){menuBuilder.clearNode("menuDiv");siteMenu.buildMenu(n)})},addMenuButton:function(n,t){var u=document.getElementById("menuDiv"),i=menuBuilder.createMenuButton(n),r=function(){i.disabled=!1},f=function(){i.disabled=!0;try{t.length>0?t(r):(t(),r())}catch(n){console.log(n+"\n"+n.stack)}};i.onclick=f;u.appendChild(i)},createMenuButton:function(n){var t=document.createElement("button");return t.innerHTML=n,t},clearMenu:function(){menuBuilder.clearNode("menuContainer");document.getElementById("loginContainer").style.visibility="hidden";document.getElementById("userDetail").style.display="none"},clearNode:function(n){for(var t=document.getElementById(n);t.firstChild;)t.removeChild(t.firstChild)}},navigation={entryPoint:function(){navigation.loadHtmlBody("mainContent","Home.html");navigation.getUserMenu()},getUserMenu:function(){main.makeWebCall(main.webApiURL+"getUserMenu","GET",navigation.processUserMenuResponse)},processUserMenuResponse:function(n){var t=n;menuBuilder.buildMenu(t)},clearSettings:function(){localStorage.removeItem(main.tokenName);localStorage.removeItem(main.userSettingName)},showLoginPage:function(){menuBuilder.clearMenu();navigation.loadHtmlBody("loginContainer","Login.html",navigation.loadLoginPageCompleted)},loadLoginPageCompleted:function(){document.getElementById("txtName").onkeypress=function(n){n.keyCode==13&&document.getElementById("txtPassword").focus()};document.getElementById("txtPassword").onkeypress=function(n){n.keyCode==13&&auth.doLogin()};document.getElementById("loginContainer").style.visibility="visible";document.getElementById("txtName").focus()},loadHtmlBody:function(n,t,i){var r="/frontend/pages/"+t+"?v="+main.version,u=function(n,t){navigation.loadHtmlBodyResponse(n,t);i&&i()};main.makeWebCall(r,"GET",u,null,n)},loadHtmlBodyResponse:function(n,t){var i=document.getElementById(t);i.innerHTML=n},getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}},siteMenu={buildMenu:function(n){var t;menuBuilder.addMenuButton("Home",function(){navigation.entryPoint()});for(t in n){var i=t,r=n[t],u=function(n){return function(){siteMenu.executeUIAction(n)}}(i);menuBuilder.addMenuButton(r,u)}},processEvent:function(n,t,i,r){var u={Data:t||"",ActionId:i};u=JSON.stringify(u);main.makeWebCall(main.webApiURL+"processEvent/"+n,"POST",siteMenu.processUIActionResponse,u,r)},executeUIAction:function(n,t){var i={Data:t||""};i=JSON.stringify(i);main.makeWebCall(main.webApiURL+"executeUIAction/"+n,"POST",siteMenu.processUIActionResponse,i,t)},processUIActionResponse:function(n,t){var f=n[0],i,r,u,e,o;n.splice(0,1);i=function(){};n.length>0&&(i=function(n){return function(){siteMenu.processUIActionResponse(n,t)}}(n));r=f;u=-1;r!=null&&r.ActionType!=null&&(u=r.ActionType);e=f;switch(u){case-1:inputDialog.showMessage(e,i,null);break;case 0:o=f.ViewData;siteMenu.populateView(o,r,null,t);i();break;case 1:siteMenu.buildInput(r,t);i();break;case 4:inputDialog.cancelInput();i();break;case 5:inputDialog.showMessage(e,i,r.Data);break;case 6:siteMenu.executeUIAction(r.EventNumber,r.ParametersToPass);i();break;default:inputDialog.showMessage("unknown action type: "+u,i,null)}},buildInput:function(n,t){inputDialog.loadInputPage("InputDialog.html",function(){var ii=document.getElementById("pageTitle"),wt,ht,bt,b,u,i,v,d,s,f,h,e,o,kt,ct,l,a,g,nt,c,lt,at,tt,dt,it,y,rt,gt,ut,ft,et,ri,p,r,vt,k;ii.innerHTML=n.Description;var yt=document.getElementById("inputTable"),w=[],pt=function(n){for(var i,t=0;t<w.length;t++)if(i=w[t],i.TriggerInputName==n)return!0;return!1};for(r=0;r<n.InputFields.length;r++)if(i=n.InputFields[r],i.VisibilityConditions!=null&&i.VisibilityConditions.length>0)for(wt=i.InputName,s=0;s<i.VisibilityConditions.length;s++)ht=i.VisibilityConditions[s],bt={InputName:wt,Condition:ht,TriggerInputName:ht.ColumnName},w.push(bt);for(b=function(n,t){var r=n.value,u,i,e,f,n;for(n.type=="checkbox"&&(r=n.checked),r=r+"",u=0;u<w.length;u++)if(i=w[u],i.TriggerInputName==t){for(e="_"+i.InputName,f=!0,i.Condition.Comparison==0?f=r===i.Condition.ColumnValue:i.Condition.Comparison==1?f=r!=i.Condition.ColumnValue:alert("Unknown comparison "+i.Condition.Comparison),n=document.getElementById(e);n.tagName!="TR";)n=n.parentNode;n.style.display=f?"":"none"}},r=0;r<n.InputFields.length;r++){u=document.createElement("tr");w.push(r);i=n.InputFields[r];switch(i.InputType){case 0:case 1:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");f.type=i.InputType==1?"password":"text";f.id="_"+i.InputName;i.DefaultValue!=null&&i.DefaultValue.length>0&&(f.value=i.DefaultValue);pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 2:inputDialog.addHiddenField("_"+i.InputName,i.DefaultValue);break;case 3:for(e=document.createElement("td"),e.innerHTML=i.InputLabel,u.appendChild(e),v=document.createElement("select"),pt(i.InputName)&&(v.onchange=function(n){return function(){b(this,n)}}(i.InputName)),v.id="_"+i.InputName,d=i.ListItems,s=0;s<d.length;s++)c=document.createElement("option"),c.value=d[s],c.text=d[s],v.appendChild(c);i.DefaultValue!=null&&i.DefaultValue.length>0&&(v.value=i.DefaultValue);h=document.createElement("td");h.appendChild(v);u.appendChild(h);break;case 4:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));f.type="checkbox";f.id="_"+i.InputName;i.DefaultValue!=null&&(f.checked=i.DefaultValue);h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 5:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);yt.appendChild(u);u=document.createElement("tr");o=document.createElement("table");o.style.fontSize="75%";o.frame="box";o.cellPadding="0";o.style.padding="0";var ot=document.createElement("tr"),st=document.createElement("tr"),ui=document.createElement("tr"),fi=document.createElement("tr"),ni=document.createElement("td");for(ni.innerHTML=i.SelectedItemsLabel,kt=document.createElement("td"),ct=document.createElement("td"),ct.innerHTML=i.AvailableItemsLabel,ot.appendChild(ni),ot.appendChild(kt),ot.appendChild(ct),l=document.createElement("select"),l.multiple=!0,l.id="_"+i.InputName+"_1",l.size=5,l.style.width="100%",a=document.createElement("select"),a.multiple=!0,a.id="_"+i.InputName+"_2",a.size=5,a.style.width="100%",g=0;g<i.ListSource.length;g++){for(nt=i.ListSource[g],c=document.createElement("option"),c.value=nt.Key,c.text=nt.Value,lt=!1,at=i.DefaultValue||[],tt=0;tt<at.length;tt++)if(dt=at[tt],dt==nt.Key){lt=!0;break}lt?l.appendChild(c):a.appendChild(c)}it=document.createElement("td");it.rowSpan=3;it.appendChild(l);st.appendChild(it);y=document.createElement("td");y.rowSpan=3;rt=document.createElement("button");rt.innerHTML="<<";rt.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",f=document.getElementById(r),i=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(rt);gt=document.createElement("br");y.appendChild(gt);ut=document.createElement("button");ut.innerHTML=">>";ut.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",i=document.getElementById(r),f=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(ut);st.appendChild(y);ft=document.createElement("td");ft.rowSpan=3;ft.appendChild(a);st.appendChild(ft);o.appendChild(ot);o.appendChild(st);o.appendChild(ui);o.appendChild(fi);et=document.createElement("td");et.colSpan=3;et.appendChild(o);u.appendChild(et);break;default:inputDialog.showMessage("Unknown input type: "+i.InputType);continue}yt.appendChild(u)}for(r=0;r<n.InputFields.length;r++){var i=n.InputFields[r],ei="_"+i.InputName,ti=document.getElementById(ei);ti!=null&&b(ti,i.InputName)}for(ri=document.createElement("tr"),p=document.createElement("td"),p.colSpan=2,r=0;r<n.InputButtons.length;r++)vt=n.InputButtons[r],k=document.createElement("button"),k.style.margin="10px",k.innerHTML=vt.Label,k.onclick=function(i,r){return function(){for(var c={},f,u,e,s,o,h=0;h<r.InputFields.length;h++){if(f=r.InputFields[h],f.InputType==5)for(e=[],u=document.getElementById("_"+f.InputName+"_1"),s=u.options,o=0;o<s.length;o++)e.push(s[o].value);else{if(u=document.getElementById("_"+f.InputName),u==null)continue;e=u.value;u.type=="checkbox"&&(e=u.checked)}c[f.InputName]=e}t!=null&&t.length>0;siteMenu.processEvent(n.Id,c,i,t)}}(vt.ActionNumber,n),p.appendChild(k);p.style.textAlign="center";p.style.verticalAlign="middle";yt.appendChild(p)})},populateView:function(n,t,i){navigation.loadHtmlBody("mainContent","Views.html",function(){var it=views.getTable(),l=document.createElement("tr"),ot=document.getElementById("viewsTitle"),w,e,o,b,rt,a,v,h,y,k,ut,u,d,s,ft;for(ot.innerHTML=t.Description,e=0;e<t.Columns.length;e++)w=document.createElement("th"),w.innerHTML=t.Columns[e].ColumnLabel,l.appendChild(w);for(it.appendChild(l),u=0;u<n.length;u++){for(l=document.createElement("tr"),e=0;e<t.Columns.length;e++){var r=t.Columns[e],c=document.createElement("td"),f="";if(r.ColumnName!=null&&r.ColumnName.length>0){for(f=n[u],o=r.ColumnName;o.indexOf(".")>-1;)b=o.indexOf("."),rt=o.substring(0,b),f=f[rt],o=o.substring(b+1);f=f[o]}if(r.ColumnType==1?(f==!0?f=r.TrueValueDisplay:f==!1&&(f=r.FalseValueDisplay),c.innerHTML=f):r.ColumnType==2?(s=document.createElement("button"),s.onclick=function(i,r){return function(){var o=n[i].Id,f=JSON.stringify(n[i]),u=t.Columns[r],e;u.Event.ActionType==5?inputDialog.showMessage(u.Event,null,f):u.Event.ActionType==6?(e=u.Event.EventNumber,f=n[i].Id,siteMenu.executeUIAction(e,f)):inputDialog.showMessage("Unknown action type "+u.Event.ActionType)}}(u,e),r.ButtonTextSource==0?s.innerHTML=r.ButtonText:(inputDialog.showMessage("Unhandled ButtonTextSource: "+r.ButtonTextSource),s.innerHTML="????"),c.appendChild(s)):r.ColumnType==3?(a=document.createElement("a"),a.href="#",a.innerHTML=r.LinkLabel,a.onclick=function(t,i){return function(){var r={Id:n[i][t.KeyColumn]},u=t.EventNumber;siteMenu.executeUIAction(u,r)}}(r,u),c.appendChild(a)):c.innerHTML=f,r.ColumnSetting!=null&&r.ColumnSetting.ColumnSettingType==0){for(v=r.ColumnSetting.Display==0,h=!0,y=0;y<r.ColumnSetting.Conditions.length;y++){var g=r.ColumnSetting.Conditions[y],o=g.ColumnName,nt=g.Comparison,et=g.ColumnValue,p=n[u][o]||"";p=p.toString();nt==0?h=h&&p==et:nt==1?h=h&&p!=et:alert("Unknown comparison: "+nt)}if(h==!1&&v==!0||h==!0&&v==!1){var v=r.ColumnSetting.Display==0,st=c.innerHTML,tt=document.createElement("div");tt.innerHTML=st;k=document.createElement("td");k.appendChild(tt);tt.style.display="none";c=k}}l.appendChild(c)}it.appendChild(l)}for(ut=document.getElementById("viewsMenu"),menuBuilder.clearNode("viewsMenu"),u=0;u<t.ViewMenu.length;u++)d=t.ViewMenu[u],s=document.createElement("button"),s.innerHTML=d.Label,s.onclick=function(n,i){return function(){var r=t.ViewMenu[i];siteMenu.executeUIAction(n,r.ParametersToPass)}}(d.EventNumber,u),ut.appendChild(s);ft=document.getElementById("viewsFooter");ft.innerHTML=t.ViewMessage!=null&&t.ViewMessage.length>0?t.ViewMessage:"";i&&i()})}},views={getTable:function(){return document.getElementById("tblView")}},auth={doLogin:function(){var n=document.getElementById("txtName").value,t=document.getElementById("txtPassword").value,i=main.webApiURL+"token",r="grant_type=password&username="+n+"&password="+t+"&client_id="+main.applicationName;main.makeWebCall(i,"POST",auth.onLoginSuccess,r)},onLoginSuccess:function(n){console.log("login success: "+n);auth.refreshTokenResponse(n);menuBuilder.clearNode("loginContainer");main.init()},makeRefreshCall:function(){var n=auth.getRefreshToken(),t;console.log(n);t="grant_type=refresh_token&client_id="+main.applicationName+"&refresh_token="+n;main.makeWebCall(main.webApiURL+"token","POST",auth.refreshTokenResponse,t)},getRefreshToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.refresh_token!=null&&(t=n.refresh_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},getAccessToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.access_token!=null&&(t=n.access_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},refreshTokenResponse:function(n){var t=n.access_token,i=n.userName;localStorage.setItem(main.tokenName,JSON.stringify(n));auth.startRefreshTimer()},startRefreshTimer:function(){var n=localStorage.getItem(main.tokenName),t;n=JSON.parse(n);t=n[".expires"];t=new Date(t);var i=Math.abs(new Date-t)-5e3,r=i,u=n.refresh_token;setTimeout(auth.refreshTokenHandler,r)},refreshTokenHandler:function(){auth.makeRefreshCall()},clearRefreshTokenHandler:function(){clearTimeout(auth.refreshTokenHandler)},logout:function(){auth.clearRefreshTokenHandler();navigation.clearSettings();main.init()}},inputDialog={loadInputPage:function(n,t){menuBuilder.clearNode("dlgInput");document.getElementById("inputContent").style.display="inline";t=t||function(){};var i=function(){t()};navigation.loadHtmlBody("dlgInput",n,i)},cancelInput:function(){document.getElementById("inputContent").style.display="none";menuBuilder.clearNode("dlgInput")},addHiddenField:function(n,t){var r=document.getElementById("dlgInput"),i=document.createElement("input");i.type="hidden";i.value=t;i.id=n;r.appendChild(i)},getHiddenField:function(n){var t=document.getElementById(n);return t==null?"":t.value},cancelMessage:function(){document.getElementById("messageContent").style.display="none";menuBuilder.clearNode("dlgMessage")},showMessage:function(n,t,i){menuBuilder.clearNode("dlgMessage");var r=n.ConfirmationMessage;r==null&&(r=n);r=r||"";r=r.toString().replace(/\n/g,"<br/>");document.getElementById("messageContent").style.display="inline";navigation.loadHtmlBody("dlgMessage","MessageDialog.html",function(){var v=document.getElementById("msgPageTitle"),f,e,s,h,c,u;v.innerHTML="Message";var l=document.getElementById("msgTable"),a=document.createElement("tr"),o=document.createElement("td");o.colSpan=2;o.innerHTML=r;o.style.textAlign="center";a.appendChild(o);l.appendChild(a);f=document.createElement("tr");e=!1;n.ConfirmationButtonText!=null&&n.ConfirmationButtonText.length>0&&(s=function(){n.OnConfirmationUIAction>0&&siteMenu.executeUIAction(n.OnConfirmationUIAction,i);t!=null&&t()},u=inputDialog.createInputDialogButton(n.ConfirmationButtonText,s),f.appendChild(u),e=!0);n.CancelButtonText!=null&&n.CancelButtonText.length>0&&(h=function(){n.OnCancelUIAction>0&&siteMenu.executeUIAction(n.OnCancelUIAction,i);t!=null&&e==!1&&t()},u=inputDialog.createInputDialogButton(n.CancelButtonText,h),f.appendChild(u),e=!0);e==!1&&(c=function(){inputDialog.cancelInput();t!=null&&t()},u=inputDialog.createInputDialogButton("Ok",c),f.appendChild(u));l.appendChild(f)})},createInputDialogButton:function(n,t){var r=document.createElement("td"),i;return r.style.textAlign="center",i=document.createElement("button"),i.innerHTML=n,i.onclick=function(){inputDialog.cancelMessage();t&&t()},r.appendChild(i),r}},main={applicationName:"websiteTemplate",baseURL:"",webApiURL:"api/v1/",menuApiUrl:"",tokenNameSuffix:"UserToken",tokenName:"",userSettingSuffix:"UserSetting",userSettingName:"",version:"0.0.3",scriptLoaded:!1,bodyOnLoad:function(){main.baseURL="https://"+window.location.host+window.location.pathname;main.init()},init:function(){var t,n,i;menuBuilder.clearMenu();document.title=main.applicationName;main.tokenName=main.applicationName+"_"+main.tokenNameSuffix+"_"+main.version;main.userSettingName=main.applicationName+"_"+main.userSettingSuffix+"_"+main.version;main.menuApiUrl=main.webApiURL+"menu/";t=navigation.getParameterByName("confirmed");t!=null&&t.length>0&&(inputDialog.showMessage("Email for "+t+" successfully confirmed.\nYou can now log in with the credentials for "+t),n=window.location.href,i=n.lastIndexOf("?"),n=n.substring(0,i),window.history.pushState(n,main.applicationName,n));main.makeWebCall(main.webApiURL+"initialize","GET",main.processInitResponse)},processInitResponse:function(n){var t=n;document.getElementById("aUserName").innerHTML=t.User;navigation.entryPoint(t);auth.startRefreshTimer()},makeWebCall:function(n,t,i,r,u){var f,e;main.showBusyIndicator1();t=t||"GET";f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){main.processWebRequest(f,i,u)};n=main.baseURL+n;f.open(t,n,!0);e=auth.getAccessToken();f.setRequestHeader("Authorization","Bearer "+e);f.send(r)},processWebRequest:function(n,t,i){var e,u,r,o,f;if(n.readyState===4){main.hideBusyIndicator();switch(n.status){case 200:u=n.getResponseHeader("content-type");u=u||"";e=n.responseText;u.indexOf("application/json")>-1&&(e=JSON.parse(e));t(e,i);break;case 400:if(u=n.getResponseHeader("content-type"),u=u||"",r=n.response,u.indexOf("application/json")>-1&&(r=JSON.parse(r)),r&&r.error&&r.error_description)switch(r.error){case"invalid_grant":o=document.getElementById("loginErrorMessage");o==null&&(inputDialog.showMessage("Not on login page. But expected to be on login page"),main.init());o.innerHTML=r.error_description;break;default:inputDialog.showMessage("unknown error description: "+r.error_description)}else inputDialog.showMessage(r.Message);break;case 401:navigation.showLoginPage();break;case 403:inputDialog.showMessage("You are not authorized to perform the requested action.\n"+n.statusText);break;case 500:f=JSON.parse(n.response);f=f.ExceptionMessage||f;inputDialog.showMessage("Internal Server Error:\n"+f);break;default:menuBuilder.clearNode("menuContainer");menuBuilder.clearNode("userDetail");navigation.loadHtmlBodyResponse(n.response,"mainContent")}}},showBusyIndicator1:function(){var n=document.getElementById("busyContainer");n.style.visibility="visible"},hideBusyIndicator:function(){var n=document.getElementById("busyContainer");n.style.visibility="hidden"}},menuBuilder={buildMenu:function(n){menuBuilder.clearMenu();document.getElementById("userDetail").style.display="inline";navigation.loadHtmlBody("menuContainer","Menu.html",function(){menuBuilder.clearNode("menuDiv");siteMenu.buildMenu(n)})},addMenuButton:function(n,t){var u=document.getElementById("menuDiv"),i=menuBuilder.createMenuButton(n),r=function(){i.disabled=!1},f=function(){i.disabled=!0;try{t.length>0?t(r):(t(),r())}catch(n){console.log(n+"\n"+n.stack)}};i.onclick=f;u.appendChild(i)},createMenuButton:function(n){var t=document.createElement("button");return t.innerHTML=n,t},clearMenu:function(){menuBuilder.clearNode("menuContainer");document.getElementById("loginContainer").style.visibility="hidden";document.getElementById("userDetail").style.display="none"},clearNode:function(n){for(var t=document.getElementById(n);t.firstChild;)t.removeChild(t.firstChild)}},navigation={entryPoint:function(){navigation.loadHtmlBody("mainContent","Home.html");navigation.getUserMenu()},getUserMenu:function(){main.makeWebCall(main.webApiURL+"getUserMenu","GET",navigation.processUserMenuResponse)},processUserMenuResponse:function(n){var t=n;menuBuilder.buildMenu(t)},clearSettings:function(){localStorage.removeItem(main.tokenName);localStorage.removeItem(main.userSettingName)},showLoginPage:function(){menuBuilder.clearMenu();navigation.loadHtmlBody("loginContainer","Login.html",navigation.loadLoginPageCompleted)},loadLoginPageCompleted:function(){document.getElementById("txtName").onkeypress=function(n){n.keyCode==13&&document.getElementById("txtPassword").focus()};document.getElementById("txtPassword").onkeypress=function(n){n.keyCode==13&&auth.doLogin()};document.getElementById("loginContainer").style.visibility="visible";document.getElementById("txtName").focus()},loadHtmlBody:function(n,t,i){var r="/frontend/pages/"+t+"?v="+main.version,u=function(n,t){navigation.loadHtmlBodyResponse(n,t);i&&i()};main.makeWebCall(r,"GET",u,null,n)},loadHtmlBodyResponse:function(n,t){var i=document.getElementById(t);i.innerHTML=n},getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}},siteMenu={buildMenu:function(n){var t;menuBuilder.addMenuButton("Home",function(){navigation.entryPoint()});for(t in n){var i=t,r=n[t],u=function(n){return function(){siteMenu.executeUIAction(n)}}(i);menuBuilder.addMenuButton(r,u)}},processEvent:function(n,t,i,r){var u={Data:t||"",ActionId:i};u=JSON.stringify(u);main.makeWebCall(main.webApiURL+"processEvent/"+n,"POST",siteMenu.processUIActionResponse,u,r)},executeUIAction:function(n,t){var i={Data:t||""};i=JSON.stringify(i);main.makeWebCall(main.webApiURL+"executeUIAction/"+n,"POST",siteMenu.processUIActionResponse,i,t)},processUIActionResponse:function(n,t){var f=n[0],i,r,u,e,o;n.splice(0,1);i=function(){};n.length>0&&(i=function(n){return function(){siteMenu.processUIActionResponse(n,t)}}(n));r=f;u=-1;r!=null&&r.ActionType!=null&&(u=r.ActionType);e=f;switch(u){case-1:inputDialog.showMessage(e,i,null);break;case 0:o=f.ViewData;siteMenu.populateView(o,r,null,t);i();break;case 1:siteMenu.buildInput(r,t);i();break;case 4:inputDialog.cancelInput();i();break;case 5:inputDialog.showMessage(e,i,r.Data);break;case 6:siteMenu.executeUIAction(r.EventNumber,r.ParametersToPass);i();break;default:inputDialog.showMessage("unknown action type: "+u,i,null)}},buildInput:function(n,t){inputDialog.loadInputPage("InputDialog.html",function(){var ii=document.getElementById("pageTitle"),wt,ht,bt,b,u,i,v,d,s,f,h,e,o,kt,ct,l,a,g,nt,c,lt,at,tt,dt,it,y,rt,gt,ut,ft,et,ri,p,r,vt,k;ii.innerHTML=n.Description;var yt=document.getElementById("inputTable"),w=[],pt=function(n){for(var i,t=0;t<w.length;t++)if(i=w[t],i.TriggerInputName==n)return!0;return!1};for(r=0;r<n.InputFields.length;r++)if(i=n.InputFields[r],i.VisibilityConditions!=null&&i.VisibilityConditions.length>0)for(wt=i.InputName,s=0;s<i.VisibilityConditions.length;s++)ht=i.VisibilityConditions[s],bt={InputName:wt,Condition:ht,TriggerInputName:ht.ColumnName},w.push(bt);for(b=function(n,t){var r=n.value,u,i,e,f,n;for(n.type=="checkbox"&&(r=n.checked),r=r+"",u=0;u<w.length;u++)if(i=w[u],i.TriggerInputName==t){for(e="_"+i.InputName,f=!0,i.Condition.Comparison==0?f=r===i.Condition.ColumnValue:i.Condition.Comparison==1?f=r!=i.Condition.ColumnValue:alert("Unknown comparison "+i.Condition.Comparison),n=document.getElementById(e);n.tagName!="TR";)n=n.parentNode;n.style.display=f?"":"none"}},r=0;r<n.InputFields.length;r++){u=document.createElement("tr");w.push(r);i=n.InputFields[r];switch(i.InputType){case 0:case 1:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");f.type=i.InputType==1?"password":"text";f.id="_"+i.InputName;i.DefaultValue!=null&&i.DefaultValue.length>0&&(f.value=i.DefaultValue);pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 2:inputDialog.addHiddenField("_"+i.InputName,i.DefaultValue);break;case 3:for(e=document.createElement("td"),e.innerHTML=i.InputLabel,u.appendChild(e),v=document.createElement("select"),pt(i.InputName)&&(v.onchange=function(n){return function(){b(this,n)}}(i.InputName)),v.id="_"+i.InputName,d=i.ListItems,s=0;s<d.length;s++)c=document.createElement("option"),c.value=d[s],c.text=d[s],v.appendChild(c);i.DefaultValue!=null&&i.DefaultValue.length>0&&(v.value=i.DefaultValue);h=document.createElement("td");h.appendChild(v);u.appendChild(h);break;case 4:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));f.type="checkbox";f.id="_"+i.InputName;i.DefaultValue!=null&&(f.checked=i.DefaultValue);h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 5:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);yt.appendChild(u);u=document.createElement("tr");o=document.createElement("table");o.style.fontSize="75%";o.frame="box";o.cellPadding="0";o.style.padding="0";var ot=document.createElement("tr"),st=document.createElement("tr"),ui=document.createElement("tr"),fi=document.createElement("tr"),ni=document.createElement("td");for(ni.innerHTML=i.SelectedItemsLabel,kt=document.createElement("td"),ct=document.createElement("td"),ct.innerHTML=i.AvailableItemsLabel,ot.appendChild(ni),ot.appendChild(kt),ot.appendChild(ct),l=document.createElement("select"),l.multiple=!0,l.id="_"+i.InputName+"_1",l.size=5,l.style.width="100%",a=document.createElement("select"),a.multiple=!0,a.id="_"+i.InputName+"_2",a.size=5,a.style.width="100%",g=0;g<i.ListSource.length;g++){for(nt=i.ListSource[g],c=document.createElement("option"),c.value=nt.Key,c.text=nt.Value,lt=!1,at=i.DefaultValue||[],tt=0;tt<at.length;tt++)if(dt=at[tt],dt==nt.Key){lt=!0;break}lt?l.appendChild(c):a.appendChild(c)}it=document.createElement("td");it.rowSpan=3;it.appendChild(l);st.appendChild(it);y=document.createElement("td");y.rowSpan=3;rt=document.createElement("button");rt.innerHTML="<<";rt.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",f=document.getElementById(r),i=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(rt);gt=document.createElement("br");y.appendChild(gt);ut=document.createElement("button");ut.innerHTML=">>";ut.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",i=document.getElementById(r),f=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(ut);st.appendChild(y);ft=document.createElement("td");ft.rowSpan=3;ft.appendChild(a);st.appendChild(ft);o.appendChild(ot);o.appendChild(st);o.appendChild(ui);o.appendChild(fi);et=document.createElement("td");et.colSpan=3;et.appendChild(o);u.appendChild(et);break;default:inputDialog.showMessage("Unknown input type: "+i.InputType);continue}yt.appendChild(u)}for(r=0;r<n.InputFields.length;r++){var i=n.InputFields[r],ei="_"+i.InputName,ti=document.getElementById(ei);ti!=null&&b(ti,i.InputName)}for(ri=document.createElement("tr"),p=document.createElement("td"),p.colSpan=2,r=0;r<n.InputButtons.length;r++)vt=n.InputButtons[r],k=document.createElement("button"),k.style.margin="10px",k.innerHTML=vt.Label,k.onclick=function(i,r){return function(){for(var c={},f,u,e,s,o,h=0;h<r.InputFields.length;h++){if(f=r.InputFields[h],f.InputType==5)for(e=[],u=document.getElementById("_"+f.InputName+"_1"),s=u.options,o=0;o<s.length;o++)e.push(s[o].value);else{if(u=document.getElementById("_"+f.InputName),u==null)continue;e=u.value;u.type=="checkbox"&&(e=u.checked)}c[f.InputName]=e}t!=null&&t.length>0;siteMenu.processEvent(n.Id,c,i,t)}}(vt.ActionNumber,n),p.appendChild(k);p.style.textAlign="center";p.style.verticalAlign="middle";yt.appendChild(p)})},populateView:function(n,t,i){navigation.loadHtmlBody("mainContent","Views.html",function(){var it=views.getTable(),l=document.createElement("tr"),ot=document.getElementById("viewsTitle"),w,e,o,b,rt,a,v,h,y,k,ut,u,d,s,ft;for(ot.innerHTML=t.Description,e=0;e<t.Columns.length;e++)w=document.createElement("th"),w.innerHTML=t.Columns[e].ColumnLabel,l.appendChild(w);for(it.appendChild(l),u=0;u<n.length;u++){for(l=document.createElement("tr"),e=0;e<t.Columns.length;e++){var r=t.Columns[e],c=document.createElement("td"),f="";if(r.ColumnName!=null&&r.ColumnName.length>0){for(f=n[u],o=r.ColumnName;o.indexOf(".")>-1;)b=o.indexOf("."),rt=o.substring(0,b),f=f[rt],o=o.substring(b+1);f=f[o]}if(r.ColumnType==1?(f==!0?f=r.TrueValueDisplay:f==!1&&(f=r.FalseValueDisplay),c.innerHTML=f):r.ColumnType==2?(s=document.createElement("button"),s.onclick=function(i,r){return function(){var o=n[i].Id,f=JSON.stringify(n[i]),u=t.Columns[r],e;u.Event.ActionType==5?inputDialog.showMessage(u.Event,null,f):u.Event.ActionType==6?(e=u.Event.EventNumber,f=n[i].Id,siteMenu.executeUIAction(e,f)):inputDialog.showMessage("Unknown action type "+u.Event.ActionType)}}(u,e),r.ButtonTextSource==0?s.innerHTML=r.ButtonText:(inputDialog.showMessage("Unhandled ButtonTextSource: "+r.ButtonTextSource),s.innerHTML="????"),c.appendChild(s)):r.ColumnType==3?(a=document.createElement("a"),a.href="#",a.innerHTML=r.LinkLabel,a.onclick=function(t,i){return function(){var r={Id:n[i][t.KeyColumn]},u=t.EventNumber;siteMenu.executeUIAction(u,r)}}(r,u),c.appendChild(a)):c.innerHTML=f,r.ColumnSetting!=null&&r.ColumnSetting.ColumnSettingType==0){for(v=r.ColumnSetting.Display==0,h=!0,y=0;y<r.ColumnSetting.Conditions.length;y++){var g=r.ColumnSetting.Conditions[y],o=g.ColumnName,nt=g.Comparison,et=g.ColumnValue,p=n[u][o]||"";p=p.toString();nt==0?h=h&&p==et:nt==1?h=h&&p!=et:alert("Unknown comparison: "+nt)}if(h==!1&&v==!0||h==!0&&v==!1){var v=r.ColumnSetting.Display==0,st=c.innerHTML,tt=document.createElement("div");tt.innerHTML=st;k=document.createElement("td");k.appendChild(tt);tt.style.display="none";c=k}}l.appendChild(c)}it.appendChild(l)}for(ut=document.getElementById("viewsMenu"),menuBuilder.clearNode("viewsMenu"),u=0;u<t.ViewMenu.length;u++)d=t.ViewMenu[u],s=document.createElement("button"),s.innerHTML=d.Label,s.onclick=function(n,i){return function(){var r=t.ViewMenu[i];siteMenu.executeUIAction(n,r.ParametersToPass)}}(d.EventNumber,u),ut.appendChild(s);ft=document.getElementById("viewsFooter");ft.innerHTML=t.ViewMessage!=null&&t.ViewMessage.length>0?t.ViewMessage:"";i&&i()})}},views={getTable:function(){return document.getElementById("tblView")}},auth={doLogin:function(){var n=document.getElementById("txtName").value,t=document.getElementById("txtPassword").value,i=main.webApiURL+"token",r="grant_type=password&username="+n+"&password="+t+"&client_id="+main.applicationName;main.makeWebCall(i,"POST",auth.onLoginSuccess,r)},onLoginSuccess:function(n){console.log("login success: "+n);auth.refreshTokenResponse(n);menuBuilder.clearNode("loginContainer");main.init()},makeRefreshCall:function(){var n=auth.getRefreshToken(),t;console.log(n);t="grant_type=refresh_token&client_id="+main.applicationName+"&refresh_token="+n;main.makeWebCall(main.webApiURL+"token","POST",auth.refreshTokenResponse,t)},getRefreshToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.refresh_token!=null&&(t=n.refresh_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},getAccessToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.access_token!=null&&(t=n.access_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},refreshTokenResponse:function(n){var t=n.access_token,i=n.userName;localStorage.setItem(main.tokenName,JSON.stringify(n));auth.startRefreshTimer()},startRefreshTimer:function(){var n=localStorage.getItem(main.tokenName),t;n=JSON.parse(n);t=n[".expires"];t=new Date(t);var i=Math.abs(new Date-t)-5e3,r=i,u=n.refresh_token;setTimeout(auth.refreshTokenHandler,r)},refreshTokenHandler:function(){auth.makeRefreshCall()},clearRefreshTokenHandler:function(){clearTimeout(auth.refreshTokenHandler)},logout:function(){auth.clearRefreshTokenHandler();navigation.clearSettings();main.init()}},inputDialog={loadInputPage:function(n,t){menuBuilder.clearNode("dlgInput");document.getElementById("inputContent").style.display="inline";t=t||function(){};var i=function(){t()};navigation.loadHtmlBody("dlgInput",n,i)},cancelInput:function(){document.getElementById("inputContent").style.display="none";menuBuilder.clearNode("dlgInput")},addHiddenField:function(n,t){var r=document.getElementById("dlgInput"),i=document.createElement("input");i.type="hidden";i.value=t;i.id=n;r.appendChild(i)},getHiddenField:function(n){var t=document.getElementById(n);return t==null?"":t.value},cancelMessage:function(){document.getElementById("messageContent").style.display="none";menuBuilder.clearNode("dlgMessage")},showMessage:function(n,t,i){menuBuilder.clearNode("dlgMessage");var r=n.ConfirmationMessage;r==null&&(r=n);r=r||"";r=r.toString().replace(/\n/g,"<br/>");document.getElementById("messageContent").style.display="inline";navigation.loadHtmlBody("dlgMessage","MessageDialog.html",function(){var v=document.getElementById("msgPageTitle"),f,e,s,h,c,u;v.innerHTML="Message";var l=document.getElementById("msgTable"),a=document.createElement("tr"),o=document.createElement("td");o.colSpan=2;o.innerHTML=r;o.style.textAlign="center";a.appendChild(o);l.appendChild(a);f=document.createElement("tr");e=!1;n.ConfirmationButtonText!=null&&n.ConfirmationButtonText.length>0&&(s=function(){n.OnConfirmationUIAction>0&&siteMenu.executeUIAction(n.OnConfirmationUIAction,i);t!=null&&t()},u=inputDialog.createInputDialogButton(n.ConfirmationButtonText,s),f.appendChild(u),e=!0);n.CancelButtonText!=null&&n.CancelButtonText.length>0&&(h=function(){n.OnCancelUIAction>0&&siteMenu.executeUIAction(n.OnCancelUIAction,i);t!=null&&e==!1&&t()},u=inputDialog.createInputDialogButton(n.CancelButtonText,h),f.appendChild(u),e=!0);e==!1&&(c=function(){inputDialog.cancelInput();t!=null&&t()},u=inputDialog.createInputDialogButton("Ok",c),f.appendChild(u));l.appendChild(f)})},createInputDialogButton:function(n,t){var r=document.createElement("td"),i;return r.style.textAlign="center",i=document.createElement("button"),i.innerHTML=n,i.onclick=function(){inputDialog.cancelMessage();t&&t()},r.appendChild(i),r}},main={applicationName:"websiteTemplate",baseURL:"",webApiURL:"api/v1/",menuApiUrl:"",tokenNameSuffix:"UserToken",tokenName:"",userSettingSuffix:"UserSetting",userSettingName:"",version:"0.0.3",scriptLoaded:!1,bodyOnLoad:function(){main.baseURL="https://"+window.location.host+window.location.pathname;main.init()},init:function(){var t,n,i;menuBuilder.clearMenu();document.title=main.applicationName;main.tokenName=main.applicationName+"_"+main.tokenNameSuffix+"_"+main.version;main.userSettingName=main.applicationName+"_"+main.userSettingSuffix+"_"+main.version;main.menuApiUrl=main.webApiURL+"menu/";t=navigation.getParameterByName("confirmed");t!=null&&t.length>0&&(inputDialog.showMessage("Email for "+t+" successfully confirmed.\nYou can now log in with the credentials for "+t),n=window.location.href,i=n.lastIndexOf("?"),n=n.substring(0,i),window.history.pushState(n,main.applicationName,n));main.makeWebCall(main.webApiURL+"initialize","GET",main.processInitResponse)},processInitResponse:function(n){var t=n;document.getElementById("aUserName").innerHTML=t.User;navigation.entryPoint(t);auth.startRefreshTimer()},makeWebCall:function(n,t,i,r,u){var f,e;main.showBusyIndicator1();t=t||"GET";f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){main.processWebRequest(f,i,u)};n=main.baseURL+n;f.open(t,n,!0);e=auth.getAccessToken();f.setRequestHeader("Authorization","Bearer "+e);f.send(r)},processWebRequest:function(n,t,i){var e,u,r,o,f;if(n.readyState===4){main.hideBusyIndicator();switch(n.status){case 200:u=n.getResponseHeader("content-type");u=u||"";e=n.responseText;u.indexOf("application/json")>-1&&(e=JSON.parse(e));t(e,i);break;case 400:if(u=n.getResponseHeader("content-type"),u=u||"",r=n.response,u.indexOf("application/json")>-1&&(r=JSON.parse(r)),r&&r.error&&r.error_description)switch(r.error){case"invalid_grant":o=document.getElementById("loginErrorMessage");o==null&&(inputDialog.showMessage("Not on login page. But expected to be on login page"),main.init());o.innerHTML=r.error_description;break;default:inputDialog.showMessage("unknown error description: "+r.error_description)}else inputDialog.showMessage(r.Message);break;case 401:navigation.showLoginPage();break;case 403:inputDialog.showMessage("You are not authorized to perform the requested action.\n"+n.statusText);break;case 500:f=JSON.parse(n.response);f=f.ExceptionMessage||f;inputDialog.showMessage("Internal Server Error:\n"+f);break;default:menuBuilder.clearNode("menuContainer");menuBuilder.clearNode("userDetail");navigation.loadHtmlBodyResponse(n.response,"mainContent")}}},showBusyIndicator1:function(){var n=document.getElementById("busyContainer");n.style.visibility="visible"},hideBusyIndicator:function(){var n=document.getElementById("busyContainer");n.style.visibility="hidden"}},menuBuilder={buildMenu:function(n){menuBuilder.clearMenu();document.getElementById("userDetail").style.display="inline";navigation.loadHtmlBody("menuContainer","Menu.html",function(){menuBuilder.clearNode("menuDiv");siteMenu.buildMenu(n)})},addMenuButton:function(n,t){var u=document.getElementById("menuDiv"),i=menuBuilder.createMenuButton(n),r=function(){i.disabled=!1},f=function(){i.disabled=!0;try{t.length>0?t(r):(t(),r())}catch(n){console.log(n+"\n"+n.stack)}};i.onclick=f;u.appendChild(i)},createMenuButton:function(n){var t=document.createElement("button");return t.innerHTML=n,t},clearMenu:function(){menuBuilder.clearNode("menuContainer");document.getElementById("loginContainer").style.visibility="hidden";document.getElementById("userDetail").style.display="none"},clearNode:function(n){for(var t=document.getElementById(n);t.firstChild;)t.removeChild(t.firstChild)}},navigation={entryPoint:function(){navigation.loadHtmlBody("mainContent","Home.html");navigation.getUserMenu()},getUserMenu:function(){main.makeWebCall(main.webApiURL+"getUserMenu","GET",navigation.processUserMenuResponse)},processUserMenuResponse:function(n){var t=n;menuBuilder.buildMenu(t)},clearSettings:function(){localStorage.removeItem(main.tokenName);localStorage.removeItem(main.userSettingName)},showLoginPage:function(){menuBuilder.clearMenu();navigation.loadHtmlBody("loginContainer","Login.html",navigation.loadLoginPageCompleted)},loadLoginPageCompleted:function(){document.getElementById("txtName").onkeypress=function(n){n.keyCode==13&&document.getElementById("txtPassword").focus()};document.getElementById("txtPassword").onkeypress=function(n){n.keyCode==13&&auth.doLogin()};document.getElementById("loginContainer").style.visibility="visible";document.getElementById("txtName").focus()},loadHtmlBody:function(n,t,i){var r="/frontend/pages/"+t+"?v="+main.version,u=function(n,t){navigation.loadHtmlBodyResponse(n,t);i&&i()};main.makeWebCall(r,"GET",u,null,n)},loadHtmlBodyResponse:function(n,t){var i=document.getElementById(t);i.innerHTML=n},getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}},siteMenu={buildMenu:function(n){var t;menuBuilder.addMenuButton("Home",function(){navigation.entryPoint()});for(t in n){var i=t,r=n[t],u=function(n){return function(){siteMenu.executeUIAction(n)}}(i);menuBuilder.addMenuButton(r,u)}},processEvent:function(n,t,i,r){var u={Data:t||"",ActionId:i};u=JSON.stringify(u);main.makeWebCall(main.webApiURL+"processEvent/"+n,"POST",siteMenu.processUIActionResponse,u,r)},executeUIAction:function(n,t){var i={Data:t||""};i=JSON.stringify(i);main.makeWebCall(main.webApiURL+"executeUIAction/"+n,"POST",siteMenu.processUIActionResponse,i,t)},processUIActionResponse:function(n,t){var f=n[0],i,r,u,e,o;n.splice(0,1);i=function(){};n.length>0&&(i=function(n){return function(){siteMenu.processUIActionResponse(n,t)}}(n));r=f;u=-1;r!=null&&r.ActionType!=null&&(u=r.ActionType);e=f;switch(u){case-1:inputDialog.showMessage(e,i,null);break;case 0:o=f.ViewData;siteMenu.populateView(o,r,null,t);i();break;case 1:siteMenu.buildInput(r,t);i();break;case 4:inputDialog.cancelInput();i();break;case 5:inputDialog.showMessage(e,i,r.Data);break;case 6:siteMenu.executeUIAction(r.EventNumber,r.ParametersToPass);i();break;default:inputDialog.showMessage("unknown action type: "+u,i,null)}},buildInput:function(n,t){inputDialog.loadInputPage("InputDialog.html",function(){var ii=document.getElementById("pageTitle"),wt,ht,bt,b,u,i,v,d,s,f,h,e,o,kt,ct,l,a,g,nt,c,lt,at,tt,dt,it,y,rt,gt,ut,ft,et,ri,p,r,vt,k;ii.innerHTML=n.Description;var yt=document.getElementById("inputTable"),w=[],pt=function(n){for(var i,t=0;t<w.length;t++)if(i=w[t],i.TriggerInputName==n)return!0;return!1};for(r=0;r<n.InputFields.length;r++)if(i=n.InputFields[r],i.VisibilityConditions!=null&&i.VisibilityConditions.length>0)for(wt=i.InputName,s=0;s<i.VisibilityConditions.length;s++)ht=i.VisibilityConditions[s],bt={InputName:wt,Condition:ht,TriggerInputName:ht.ColumnName},w.push(bt);for(b=function(n,t){var r=n.value,u,i,e,f,n;for(n.type=="checkbox"&&(r=n.checked),r=r+"",u=0;u<w.length;u++)if(i=w[u],i.TriggerInputName==t){for(e="_"+i.InputName,f=!0,i.Condition.Comparison==0?f=r===i.Condition.ColumnValue:i.Condition.Comparison==1?f=r!=i.Condition.ColumnValue:alert("Unknown comparison "+i.Condition.Comparison),n=document.getElementById(e);n.tagName!="TR";)n=n.parentNode;n.style.display=f?"":"none"}},r=0;r<n.InputFields.length;r++){u=document.createElement("tr");w.push(r);i=n.InputFields[r];switch(i.InputType){case 0:case 1:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");f.type=i.InputType==1?"password":"text";f.id="_"+i.InputName;i.DefaultValue!=null&&i.DefaultValue.length>0&&(f.value=i.DefaultValue);pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 2:inputDialog.addHiddenField("_"+i.InputName,i.DefaultValue);break;case 3:for(e=document.createElement("td"),e.innerHTML=i.InputLabel,u.appendChild(e),v=document.createElement("select"),pt(i.InputName)&&(v.onchange=function(n){return function(){b(this,n)}}(i.InputName)),v.id="_"+i.InputName,d=i.ListItems,s=0;s<d.length;s++)c=document.createElement("option"),c.value=d[s],c.text=d[s],v.appendChild(c);i.DefaultValue!=null&&i.DefaultValue.length>0&&(v.value=i.DefaultValue);h=document.createElement("td");h.appendChild(v);u.appendChild(h);break;case 4:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));f.type="checkbox";f.id="_"+i.InputName;i.DefaultValue!=null&&(f.checked=i.DefaultValue);h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 5:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);yt.appendChild(u);u=document.createElement("tr");o=document.createElement("table");o.style.fontSize="75%";o.frame="box";o.cellPadding="0";o.style.padding="0";var ot=document.createElement("tr"),st=document.createElement("tr"),ui=document.createElement("tr"),fi=document.createElement("tr"),ni=document.createElement("td");for(ni.innerHTML=i.SelectedItemsLabel,kt=document.createElement("td"),ct=document.createElement("td"),ct.innerHTML=i.AvailableItemsLabel,ot.appendChild(ni),ot.appendChild(kt),ot.appendChild(ct),l=document.createElement("select"),l.multiple=!0,l.id="_"+i.InputName+"_1",l.size=5,l.style.width="100%",a=document.createElement("select"),a.multiple=!0,a.id="_"+i.InputName+"_2",a.size=5,a.style.width="100%",g=0;g<i.ListSource.length;g++){for(nt=i.ListSource[g],c=document.createElement("option"),c.value=nt.Key,c.text=nt.Value,lt=!1,at=i.DefaultValue||[],tt=0;tt<at.length;tt++)if(dt=at[tt],dt==nt.Key){lt=!0;break}lt?l.appendChild(c):a.appendChild(c)}it=document.createElement("td");it.rowSpan=3;it.appendChild(l);st.appendChild(it);y=document.createElement("td");y.rowSpan=3;rt=document.createElement("button");rt.innerHTML="<<";rt.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",f=document.getElementById(r),i=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(rt);gt=document.createElement("br");y.appendChild(gt);ut=document.createElement("button");ut.innerHTML=">>";ut.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",i=document.getElementById(r),f=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(ut);st.appendChild(y);ft=document.createElement("td");ft.rowSpan=3;ft.appendChild(a);st.appendChild(ft);o.appendChild(ot);o.appendChild(st);o.appendChild(ui);o.appendChild(fi);et=document.createElement("td");et.colSpan=3;et.appendChild(o);u.appendChild(et);break;default:inputDialog.showMessage("Unknown input type: "+i.InputType);continue}yt.appendChild(u)}for(r=0;r<n.InputFields.length;r++){var i=n.InputFields[r],ei="_"+i.InputName,ti=document.getElementById(ei);ti!=null&&b(ti,i.InputName)}for(ri=document.createElement("tr"),p=document.createElement("td"),p.colSpan=2,r=0;r<n.InputButtons.length;r++)vt=n.InputButtons[r],k=document.createElement("button"),k.style.margin="10px",k.innerHTML=vt.Label,k.onclick=function(i,r){return function(){for(var c={},f,u,e,s,o,h=0;h<r.InputFields.length;h++){if(f=r.InputFields[h],f.InputType==5)for(e=[],u=document.getElementById("_"+f.InputName+"_1"),s=u.options,o=0;o<s.length;o++)e.push(s[o].value);else{if(u=document.getElementById("_"+f.InputName),u==null)continue;e=u.value;u.type=="checkbox"&&(e=u.checked)}c[f.InputName]=e}t!=null&&t.length>0;siteMenu.processEvent(n.Id,c,i,t)}}(vt.ActionNumber,n),p.appendChild(k);p.style.textAlign="center";p.style.verticalAlign="middle";yt.appendChild(p)})},populateView:function(n,t,i){navigation.loadHtmlBody("mainContent","Views.html",function(){var it=views.getTable(),l=document.createElement("tr"),ot=document.getElementById("viewsTitle"),w,e,o,b,rt,a,v,h,y,k,ut,u,d,s,ft;for(ot.innerHTML=t.Description,e=0;e<t.Columns.length;e++)w=document.createElement("th"),w.innerHTML=t.Columns[e].ColumnLabel,l.appendChild(w);for(it.appendChild(l),u=0;u<n.length;u++){for(l=document.createElement("tr"),e=0;e<t.Columns.length;e++){var r=t.Columns[e],c=document.createElement("td"),f="";if(r.ColumnName!=null&&r.ColumnName.length>0){for(f=n[u],o=r.ColumnName;o.indexOf(".")>-1;)b=o.indexOf("."),rt=o.substring(0,b),f=f[rt],o=o.substring(b+1);f=f[o]}if(r.ColumnType==1?(f==!0?f=r.TrueValueDisplay:f==!1&&(f=r.FalseValueDisplay),c.innerHTML=f):r.ColumnType==2?(s=document.createElement("button"),s.onclick=function(i,r){return function(){var o=n[i].Id,f=JSON.stringify(n[i]),u=t.Columns[r],e;u.Event.ActionType==5?inputDialog.showMessage(u.Event,null,f):u.Event.ActionType==6?(e=u.Event.EventNumber,f=n[i].Id,siteMenu.executeUIAction(e,f)):inputDialog.showMessage("Unknown action type "+u.Event.ActionType)}}(u,e),r.ButtonTextSource==0?s.innerHTML=r.ButtonText:(inputDialog.showMessage("Unhandled ButtonTextSource: "+r.ButtonTextSource),s.innerHTML="????"),c.appendChild(s)):r.ColumnType==3?(a=document.createElement("a"),a.href="#",a.innerHTML=r.LinkLabel,a.onclick=function(t,i){return function(){var r={Id:n[i][t.KeyColumn]},u=t.EventNumber;siteMenu.executeUIAction(u,r)}}(r,u),c.appendChild(a)):c.innerHTML=f,r.ColumnSetting!=null&&r.ColumnSetting.ColumnSettingType==0){for(v=r.ColumnSetting.Display==0,h=!0,y=0;y<r.ColumnSetting.Conditions.length;y++){var g=r.ColumnSetting.Conditions[y],o=g.ColumnName,nt=g.Comparison,et=g.ColumnValue,p=n[u][o]||"";p=p.toString();nt==0?h=h&&p==et:nt==1?h=h&&p!=et:alert("Unknown comparison: "+nt)}if(h==!1&&v==!0||h==!0&&v==!1){var v=r.ColumnSetting.Display==0,st=c.innerHTML,tt=document.createElement("div");tt.innerHTML=st;k=document.createElement("td");k.appendChild(tt);tt.style.display="none";c=k}}l.appendChild(c)}it.appendChild(l)}for(ut=document.getElementById("viewsMenu"),menuBuilder.clearNode("viewsMenu"),u=0;u<t.ViewMenu.length;u++)d=t.ViewMenu[u],s=document.createElement("button"),s.innerHTML=d.Label,s.onclick=function(n,i){return function(){var r=t.ViewMenu[i];siteMenu.executeUIAction(n,r.ParametersToPass)}}(d.EventNumber,u),ut.appendChild(s);ft=document.getElementById("viewsFooter");ft.innerHTML=t.ViewMessage!=null&&t.ViewMessage.length>0?t.ViewMessage:"";i&&i()})}},views={getTable:function(){return document.getElementById("tblView")}},auth={doLogin:function(){var n=document.getElementById("txtName").value,t=document.getElementById("txtPassword").value,i=main.webApiURL+"token",r="grant_type=password&username="+n+"&password="+t+"&client_id="+main.applicationName;main.makeWebCall(i,"POST",auth.onLoginSuccess,r)},onLoginSuccess:function(n){console.log("login success: "+n);auth.refreshTokenResponse(n);menuBuilder.clearNode("loginContainer");main.init()},makeRefreshCall:function(){var n=auth.getRefreshToken(),t;console.log(n);t="grant_type=refresh_token&client_id="+main.applicationName+"&refresh_token="+n;main.makeWebCall(main.webApiURL+"token","POST",auth.refreshTokenResponse,t)},getRefreshToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.refresh_token!=null&&(t=n.refresh_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},getAccessToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.access_token!=null&&(t=n.access_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},refreshTokenResponse:function(n){var t=n.access_token,i=n.userName;localStorage.setItem(main.tokenName,JSON.stringify(n));auth.startRefreshTimer()},startRefreshTimer:function(){var n=localStorage.getItem(main.tokenName),t;n=JSON.parse(n);t=n[".expires"];t=new Date(t);var i=Math.abs(new Date-t)-5e3,r=i,u=n.refresh_token;setTimeout(auth.refreshTokenHandler,r)},refreshTokenHandler:function(){auth.makeRefreshCall()},clearRefreshTokenHandler:function(){clearTimeout(auth.refreshTokenHandler)},logout:function(){auth.clearRefreshTokenHandler();navigation.clearSettings();main.init()}},inputDialog={loadInputPage:function(n,t){menuBuilder.clearNode("dlgInput");document.getElementById("inputContent").style.display="inline";t=t||function(){};var i=function(){t()};navigation.loadHtmlBody("dlgInput",n,i)},cancelInput:function(){document.getElementById("inputContent").style.display="none";menuBuilder.clearNode("dlgInput")},addHiddenField:function(n,t){var r=document.getElementById("dlgInput"),i=document.createElement("input");i.type="hidden";i.value=t;i.id=n;r.appendChild(i)},getHiddenField:function(n){var t=document.getElementById(n);return t==null?"":t.value},cancelMessage:function(){document.getElementById("messageContent").style.display="none";menuBuilder.clearNode("dlgMessage")},showMessage:function(n,t,i){menuBuilder.clearNode("dlgMessage");var r=n.ConfirmationMessage;r==null&&(r=n);r=r||"";r=r.toString().replace(/\n/g,"<br/>");document.getElementById("messageContent").style.display="inline";navigation.loadHtmlBody("dlgMessage","MessageDialog.html",function(){var v=document.getElementById("msgPageTitle"),f,e,s,h,c,u;v.innerHTML="Message";var l=document.getElementById("msgTable"),a=document.createElement("tr"),o=document.createElement("td");o.colSpan=2;o.innerHTML=r;o.style.textAlign="center";a.appendChild(o);l.appendChild(a);f=document.createElement("tr");e=!1;n.ConfirmationButtonText!=null&&n.ConfirmationButtonText.length>0&&(s=function(){n.OnConfirmationUIAction>0&&siteMenu.executeUIAction(n.OnConfirmationUIAction,i);t!=null&&t()},u=inputDialog.createInputDialogButton(n.ConfirmationButtonText,s),f.appendChild(u),e=!0);n.CancelButtonText!=null&&n.CancelButtonText.length>0&&(h=function(){n.OnCancelUIAction>0&&siteMenu.executeUIAction(n.OnCancelUIAction,i);t!=null&&e==!1&&t()},u=inputDialog.createInputDialogButton(n.CancelButtonText,h),f.appendChild(u),e=!0);e==!1&&(c=function(){inputDialog.cancelInput();t!=null&&t()},u=inputDialog.createInputDialogButton("Ok",c),f.appendChild(u));l.appendChild(f)})},createInputDialogButton:function(n,t){var r=document.createElement("td"),i;return r.style.textAlign="center",i=document.createElement("button"),i.innerHTML=n,i.onclick=function(){inputDialog.cancelMessage();t&&t()},r.appendChild(i),r}},main={applicationName:"websiteTemplate",baseURL:"",webApiURL:"api/v1/",menuApiUrl:"",tokenNameSuffix:"UserToken",tokenName:"",userSettingSuffix:"UserSetting",userSettingName:"",version:"0.0.3",scriptLoaded:!1,bodyOnLoad:function(){main.baseURL="https://"+window.location.host+window.location.pathname;main.init()},init:function(){var t,n,i;menuBuilder.clearMenu();document.title=main.applicationName;main.tokenName=main.applicationName+"_"+main.tokenNameSuffix+"_"+main.version;main.userSettingName=main.applicationName+"_"+main.userSettingSuffix+"_"+main.version;main.menuApiUrl=main.webApiURL+"menu/";t=navigation.getParameterByName("confirmed");t!=null&&t.length>0&&(inputDialog.showMessage("Email for "+t+" successfully confirmed.\nYou can now log in with the credentials for "+t),n=window.location.href,i=n.lastIndexOf("?"),n=n.substring(0,i),window.history.pushState(n,main.applicationName,n));main.makeWebCall(main.webApiURL+"initialize","GET",main.processInitResponse)},processInitResponse:function(n){var t=n;document.getElementById("aUserName").innerHTML=t.User;navigation.entryPoint(t);auth.startRefreshTimer()},makeWebCall:function(n,t,i,r,u){var f,e;main.showBusyIndicator1();t=t||"GET";f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){main.processWebRequest(f,i,u)};n=main.baseURL+n;f.open(t,n,!0);e=auth.getAccessToken();f.setRequestHeader("Authorization","Bearer "+e);f.send(r)},processWebRequest:function(n,t,i){var e,u,r,o,f;if(n.readyState===4){main.hideBusyIndicator();switch(n.status){case 200:u=n.getResponseHeader("content-type");u=u||"";e=n.responseText;u.indexOf("application/json")>-1&&(e=JSON.parse(e));t(e,i);break;case 400:if(u=n.getResponseHeader("content-type"),u=u||"",r=n.response,u.indexOf("application/json")>-1&&(r=JSON.parse(r)),r&&r.error&&r.error_description)switch(r.error){case"invalid_grant":o=document.getElementById("loginErrorMessage");o==null&&(inputDialog.showMessage("Not on login page. But expected to be on login page"),main.init());o.innerHTML=r.error_description;break;default:inputDialog.showMessage("unknown error description: "+r.error_description)}else inputDialog.showMessage(r.Message);break;case 401:navigation.showLoginPage();break;case 403:inputDialog.showMessage("You are not authorized to perform the requested action.\n"+n.statusText);break;case 500:f=JSON.parse(n.response);f=f.ExceptionMessage||f;inputDialog.showMessage("Internal Server Error:\n"+f);break;default:menuBuilder.clearNode("menuContainer");menuBuilder.clearNode("userDetail");navigation.loadHtmlBodyResponse(n.response,"mainContent")}}},showBusyIndicator1:function(){var n=document.getElementById("busyContainer");n.style.visibility="visible"},hideBusyIndicator:function(){var n=document.getElementById("busyContainer");n.style.visibility="hidden"}},menuBuilder={buildMenu:function(n){menuBuilder.clearMenu();document.getElementById("userDetail").style.display="inline";navigation.loadHtmlBody("menuContainer","Menu.html",function(){menuBuilder.clearNode("menuDiv");siteMenu.buildMenu(n)})},addMenuButton:function(n,t){var u=document.getElementById("menuDiv"),i=menuBuilder.createMenuButton(n),r=function(){i.disabled=!1},f=function(){i.disabled=!0;try{t.length>0?t(r):(t(),r())}catch(n){console.log(n+"\n"+n.stack)}};i.onclick=f;u.appendChild(i)},createMenuButton:function(n){var t=document.createElement("button");return t.innerHTML=n,t},clearMenu:function(){menuBuilder.clearNode("menuContainer");document.getElementById("loginContainer").style.visibility="hidden";document.getElementById("userDetail").style.display="none"},clearNode:function(n){for(var t=document.getElementById(n);t.firstChild;)t.removeChild(t.firstChild)}},navigation={entryPoint:function(){navigation.loadHtmlBody("mainContent","Home.html");navigation.getUserMenu()},getUserMenu:function(){main.makeWebCall(main.webApiURL+"getUserMenu","GET",navigation.processUserMenuResponse)},processUserMenuResponse:function(n){var t=n;menuBuilder.buildMenu(t)},clearSettings:function(){localStorage.removeItem(main.tokenName);localStorage.removeItem(main.userSettingName)},showLoginPage:function(){menuBuilder.clearMenu();navigation.loadHtmlBody("loginContainer","Login.html",navigation.loadLoginPageCompleted)},loadLoginPageCompleted:function(){document.getElementById("txtName").onkeypress=function(n){n.keyCode==13&&document.getElementById("txtPassword").focus()};document.getElementById("txtPassword").onkeypress=function(n){n.keyCode==13&&auth.doLogin()};document.getElementById("loginContainer").style.visibility="visible";document.getElementById("txtName").focus()},loadHtmlBody:function(n,t,i){var r="/frontend/pages/"+t+"?v="+main.version,u=function(n,t){navigation.loadHtmlBodyResponse(n,t);i&&i()};main.makeWebCall(r,"GET",u,null,n)},loadHtmlBodyResponse:function(n,t){var i=document.getElementById(t);i.innerHTML=n},getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}},siteMenu={buildMenu:function(n){var t;menuBuilder.addMenuButton("Home",function(){navigation.entryPoint()});for(t in n){var i=t,r=n[t],u=function(n){return function(){siteMenu.executeUIAction(n)}}(i);menuBuilder.addMenuButton(r,u)}},processEvent:function(n,t,i,r){var u={Data:t||"",ActionId:i};u=JSON.stringify(u);main.makeWebCall(main.webApiURL+"processEvent/"+n,"POST",siteMenu.processUIActionResponse,u,r)},executeUIAction:function(n,t){var i={Data:t||""};i=JSON.stringify(i);main.makeWebCall(main.webApiURL+"executeUIAction/"+n,"POST",siteMenu.processUIActionResponse,i,t)},processUIActionResponse:function(n,t){var f=n[0],i,r,u,e,o;n.splice(0,1);i=function(){};n.length>0&&(i=function(n){return function(){siteMenu.processUIActionResponse(n,t)}}(n));r=f;u=-1;r!=null&&r.ActionType!=null&&(u=r.ActionType);e=f;switch(u){case-1:inputDialog.showMessage(e,i,null);break;case 0:o=f.ViewData;siteMenu.populateView(o,r,null,t);i();break;case 1:siteMenu.buildInput(r,t);i();break;case 4:inputDialog.cancelInput();i();break;case 5:inputDialog.showMessage(e,i,r.Data);break;case 6:siteMenu.executeUIAction(r.EventNumber,r.ParametersToPass);i();break;default:inputDialog.showMessage("unknown action type: "+u,i,null)}},buildInput:function(n,t){inputDialog.loadInputPage("InputDialog.html",function(){var ii=document.getElementById("pageTitle"),wt,ht,bt,b,u,i,v,d,s,f,h,e,o,kt,ct,l,a,g,nt,c,lt,at,tt,dt,it,y,rt,gt,ut,ft,et,ri,p,r,vt,k;ii.innerHTML=n.Description;var yt=document.getElementById("inputTable"),w=[],pt=function(n){for(var i,t=0;t<w.length;t++)if(i=w[t],i.TriggerInputName==n)return!0;return!1};for(r=0;r<n.InputFields.length;r++)if(i=n.InputFields[r],i.VisibilityConditions!=null&&i.VisibilityConditions.length>0)for(wt=i.InputName,s=0;s<i.VisibilityConditions.length;s++)ht=i.VisibilityConditions[s],bt={InputName:wt,Condition:ht,TriggerInputName:ht.ColumnName},w.push(bt);for(b=function(n,t){var r=n.value,u,i,e,f,n;for(n.type=="checkbox"&&(r=n.checked),r=r+"",u=0;u<w.length;u++)if(i=w[u],i.TriggerInputName==t){for(e="_"+i.InputName,f=!0,i.Condition.Comparison==0?f=r===i.Condition.ColumnValue:i.Condition.Comparison==1?f=r!=i.Condition.ColumnValue:alert("Unknown comparison "+i.Condition.Comparison),n=document.getElementById(e);n.tagName!="TR";)n=n.parentNode;n.style.display=f?"":"none"}},r=0;r<n.InputFields.length;r++){u=document.createElement("tr");w.push(r);i=n.InputFields[r];switch(i.InputType){case 0:case 1:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");f.type=i.InputType==1?"password":"text";f.id="_"+i.InputName;i.DefaultValue!=null&&i.DefaultValue.length>0&&(f.value=i.DefaultValue);pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 2:inputDialog.addHiddenField("_"+i.InputName,i.DefaultValue);break;case 3:for(e=document.createElement("td"),e.innerHTML=i.InputLabel,u.appendChild(e),v=document.createElement("select"),pt(i.InputName)&&(v.onchange=function(n){return function(){b(this,n)}}(i.InputName)),v.id="_"+i.InputName,d=i.ListItems,s=0;s<d.length;s++)c=document.createElement("option"),c.value=d[s],c.text=d[s],v.appendChild(c);i.DefaultValue!=null&&i.DefaultValue.length>0&&(v.value=i.DefaultValue);h=document.createElement("td");h.appendChild(v);u.appendChild(h);break;case 4:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));f.type="checkbox";f.id="_"+i.InputName;i.DefaultValue!=null&&(f.checked=i.DefaultValue);h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 5:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);yt.appendChild(u);u=document.createElement("tr");o=document.createElement("table");o.style.fontSize="75%";o.frame="box";o.cellPadding="0";o.style.padding="0";var ot=document.createElement("tr"),st=document.createElement("tr"),ui=document.createElement("tr"),fi=document.createElement("tr"),ni=document.createElement("td");for(ni.innerHTML=i.SelectedItemsLabel,kt=document.createElement("td"),ct=document.createElement("td"),ct.innerHTML=i.AvailableItemsLabel,ot.appendChild(ni),ot.appendChild(kt),ot.appendChild(ct),l=document.createElement("select"),l.multiple=!0,l.id="_"+i.InputName+"_1",l.size=5,l.style.width="100%",a=document.createElement("select"),a.multiple=!0,a.id="_"+i.InputName+"_2",a.size=5,a.style.width="100%",g=0;g<i.ListSource.length;g++){for(nt=i.ListSource[g],c=document.createElement("option"),c.value=nt.Key,c.text=nt.Value,lt=!1,at=i.DefaultValue||[],tt=0;tt<at.length;tt++)if(dt=at[tt],dt==nt.Key){lt=!0;break}lt?l.appendChild(c):a.appendChild(c)}it=document.createElement("td");it.rowSpan=3;it.appendChild(l);st.appendChild(it);y=document.createElement("td");y.rowSpan=3;rt=document.createElement("button");rt.innerHTML="<<";rt.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",f=document.getElementById(r),i=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(rt);gt=document.createElement("br");y.appendChild(gt);ut=document.createElement("button");ut.innerHTML=">>";ut.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",i=document.getElementById(r),f=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(ut);st.appendChild(y);ft=document.createElement("td");ft.rowSpan=3;ft.appendChild(a);st.appendChild(ft);o.appendChild(ot);o.appendChild(st);o.appendChild(ui);o.appendChild(fi);et=document.createElement("td");et.colSpan=3;et.appendChild(o);u.appendChild(et);break;default:inputDialog.showMessage("Unknown input type: "+i.InputType);continue}yt.appendChild(u)}for(r=0;r<n.InputFields.length;r++){var i=n.InputFields[r],ei="_"+i.InputName,ti=document.getElementById(ei);ti!=null&&b(ti,i.InputName)}for(ri=document.createElement("tr"),p=document.createElement("td"),p.colSpan=2,r=0;r<n.InputButtons.length;r++)vt=n.InputButtons[r],k=document.createElement("button"),k.style.margin="10px",k.innerHTML=vt.Label,k.onclick=function(i,r){return function(){for(var c={},f,u,e,s,o,h=0;h<r.InputFields.length;h++){if(f=r.InputFields[h],f.InputType==5)for(e=[],u=document.getElementById("_"+f.InputName+"_1"),s=u.options,o=0;o<s.length;o++)e.push(s[o].value);else{if(u=document.getElementById("_"+f.InputName),u==null)continue;e=u.value;u.type=="checkbox"&&(e=u.checked)}c[f.InputName]=e}t!=null&&t.length>0;siteMenu.processEvent(n.Id,c,i,t)}}(vt.ActionNumber,n),p.appendChild(k);p.style.textAlign="center";p.style.verticalAlign="middle";yt.appendChild(p)})},populateView:function(n,t,i){navigation.loadHtmlBody("mainContent","Views.html",function(){var it=views.getTable(),l=document.createElement("tr"),ot=document.getElementById("viewsTitle"),w,e,o,b,rt,a,v,h,y,k,ut,u,d,s,ft;for(ot.innerHTML=t.Description,e=0;e<t.Columns.length;e++)w=document.createElement("th"),w.innerHTML=t.Columns[e].ColumnLabel,l.appendChild(w);for(it.appendChild(l),u=0;u<n.length;u++){for(l=document.createElement("tr"),e=0;e<t.Columns.length;e++){var r=t.Columns[e],c=document.createElement("td"),f="";if(r.ColumnName!=null&&r.ColumnName.length>0){for(f=n[u],o=r.ColumnName;o.indexOf(".")>-1;)b=o.indexOf("."),rt=o.substring(0,b),f=f[rt],o=o.substring(b+1);f=f[o]}if(r.ColumnType==1?(f==!0?f=r.TrueValueDisplay:f==!1&&(f=r.FalseValueDisplay),c.innerHTML=f):r.ColumnType==2?(s=document.createElement("button"),s.onclick=function(i,r){return function(){var o=n[i].Id,f=JSON.stringify(n[i]),u=t.Columns[r],e;u.Event.ActionType==5?inputDialog.showMessage(u.Event,null,f):u.Event.ActionType==6?(e=u.Event.EventNumber,f=n[i].Id,siteMenu.executeUIAction(e,f)):inputDialog.showMessage("Unknown action type "+u.Event.ActionType)}}(u,e),r.ButtonTextSource==0?s.innerHTML=r.ButtonText:(inputDialog.showMessage("Unhandled ButtonTextSource: "+r.ButtonTextSource),s.innerHTML="????"),c.appendChild(s)):r.ColumnType==3?(a=document.createElement("a"),a.href="#",a.innerHTML=r.LinkLabel,a.onclick=function(t,i){return function(){var r={Id:n[i][t.KeyColumn]},u=t.EventNumber;siteMenu.executeUIAction(u,r)}}(r,u),c.appendChild(a)):c.innerHTML=f,r.ColumnSetting!=null&&r.ColumnSetting.ColumnSettingType==0){for(v=r.ColumnSetting.Display==0,h=!0,y=0;y<r.ColumnSetting.Conditions.length;y++){var g=r.ColumnSetting.Conditions[y],o=g.ColumnName,nt=g.Comparison,et=g.ColumnValue,p=n[u][o]||"";p=p.toString();nt==0?h=h&&p==et:nt==1?h=h&&p!=et:alert("Unknown comparison: "+nt)}if(h==!1&&v==!0||h==!0&&v==!1){var v=r.ColumnSetting.Display==0,st=c.innerHTML,tt=document.createElement("div");tt.innerHTML=st;k=document.createElement("td");k.appendChild(tt);tt.style.display="none";c=k}}l.appendChild(c)}it.appendChild(l)}for(ut=document.getElementById("viewsMenu"),menuBuilder.clearNode("viewsMenu"),u=0;u<t.ViewMenu.length;u++)d=t.ViewMenu[u],s=document.createElement("button"),s.innerHTML=d.Label,s.onclick=function(n,i){return function(){var r=t.ViewMenu[i];siteMenu.executeUIAction(n,r.ParametersToPass)}}(d.EventNumber,u),ut.appendChild(s);ft=document.getElementById("viewsFooter");ft.innerHTML=t.ViewMessage!=null&&t.ViewMessage.length>0?t.ViewMessage:"";i&&i()})}},views={getTable:function(){return document.getElementById("tblView")}},auth={doLogin:function(){var n=document.getElementById("txtName").value,t=document.getElementById("txtPassword").value,i=main.webApiURL+"token",r="grant_type=password&username="+n+"&password="+t+"&client_id="+main.applicationName;main.makeWebCall(i,"POST",auth.onLoginSuccess,r)},onLoginSuccess:function(n){console.log("login success: "+n);auth.refreshTokenResponse(n);menuBuilder.clearNode("loginContainer");main.init()},makeRefreshCall:function(){var n=auth.getRefreshToken(),t;console.log(n);t="grant_type=refresh_token&client_id="+main.applicationName+"&refresh_token="+n;main.makeWebCall(main.webApiURL+"token","POST",auth.refreshTokenResponse,t)},getRefreshToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.refresh_token!=null&&(t=n.refresh_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},getAccessToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.access_token!=null&&(t=n.access_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},refreshTokenResponse:function(n){var t=n.access_token,i=n.userName;localStorage.setItem(main.tokenName,JSON.stringify(n));auth.startRefreshTimer()},startRefreshTimer:function(){var n=localStorage.getItem(main.tokenName),t;n=JSON.parse(n);t=n[".expires"];t=new Date(t);var i=Math.abs(new Date-t)-5e3,r=i,u=n.refresh_token;setTimeout(auth.refreshTokenHandler,r)},refreshTokenHandler:function(){auth.makeRefreshCall()},clearRefreshTokenHandler:function(){clearTimeout(auth.refreshTokenHandler)},logout:function(){auth.clearRefreshTokenHandler();navigation.clearSettings();main.init()}},inputDialog={loadInputPage:function(n,t){menuBuilder.clearNode("dlgInput");document.getElementById("inputContent").style.display="inline";t=t||function(){};var i=function(){t()};navigation.loadHtmlBody("dlgInput",n,i)},cancelInput:function(){document.getElementById("inputContent").style.display="none";menuBuilder.clearNode("dlgInput")},addHiddenField:function(n,t){var r=document.getElementById("dlgInput"),i=document.createElement("input");i.type="hidden";i.value=t;i.id=n;r.appendChild(i)},getHiddenField:function(n){var t=document.getElementById(n);return t==null?"":t.value},cancelMessage:function(){document.getElementById("messageContent").style.display="none";menuBuilder.clearNode("dlgMessage")},showMessage:function(n,t,i){menuBuilder.clearNode("dlgMessage");var r=n.ConfirmationMessage;r==null&&(r=n);r=r||"";r=r.toString().replace(/\n/g,"<br/>");document.getElementById("messageContent").style.display="inline";navigation.loadHtmlBody("dlgMessage","MessageDialog.html",function(){var v=document.getElementById("msgPageTitle"),f,e,s,h,c,u;v.innerHTML="Message";var l=document.getElementById("msgTable"),a=document.createElement("tr"),o=document.createElement("td");o.colSpan=2;o.innerHTML=r;o.style.textAlign="center";a.appendChild(o);l.appendChild(a);f=document.createElement("tr");e=!1;n.ConfirmationButtonText!=null&&n.ConfirmationButtonText.length>0&&(s=function(){n.OnConfirmationUIAction>0&&siteMenu.executeUIAction(n.OnConfirmationUIAction,i);t!=null&&t()},u=inputDialog.createInputDialogButton(n.ConfirmationButtonText,s),f.appendChild(u),e=!0);n.CancelButtonText!=null&&n.CancelButtonText.length>0&&(h=function(){n.OnCancelUIAction>0&&siteMenu.executeUIAction(n.OnCancelUIAction,i);t!=null&&e==!1&&t()},u=inputDialog.createInputDialogButton(n.CancelButtonText,h),f.appendChild(u),e=!0);e==!1&&(c=function(){inputDialog.cancelInput();t!=null&&t()},u=inputDialog.createInputDialogButton("Ok",c),f.appendChild(u));l.appendChild(f)})},createInputDialogButton:function(n,t){var r=document.createElement("td"),i;return r.style.textAlign="center",i=document.createElement("button"),i.innerHTML=n,i.onclick=function(){inputDialog.cancelMessage();t&&t()},r.appendChild(i),r}},main={applicationName:"websiteTemplate",baseURL:"",webApiURL:"api/v1/",menuApiUrl:"",tokenNameSuffix:"UserToken",tokenName:"",userSettingSuffix:"UserSetting",userSettingName:"",version:"0.0.3",scriptLoaded:!1,bodyOnLoad:function(){main.baseURL="https://"+window.location.host+window.location.pathname;main.init()},init:function(){var t,n,i;menuBuilder.clearMenu();document.title=main.applicationName;main.tokenName=main.applicationName+"_"+main.tokenNameSuffix+"_"+main.version;main.userSettingName=main.applicationName+"_"+main.userSettingSuffix+"_"+main.version;main.menuApiUrl=main.webApiURL+"menu/";t=navigation.getParameterByName("confirmed");t!=null&&t.length>0&&(inputDialog.showMessage("Email for "+t+" successfully confirmed.\nYou can now log in with the credentials for "+t),n=window.location.href,i=n.lastIndexOf("?"),n=n.substring(0,i),window.history.pushState(n,main.applicationName,n));main.makeWebCall(main.webApiURL+"initialize","GET",main.processInitResponse)},processInitResponse:function(n){var t=n;document.getElementById("aUserName").innerHTML=t.User;navigation.entryPoint(t);auth.startRefreshTimer()},makeWebCall:function(n,t,i,r,u){var f,e;main.showBusyIndicator1();t=t||"GET";f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){main.processWebRequest(f,i,u)};n=main.baseURL+n;f.open(t,n,!0);e=auth.getAccessToken();f.setRequestHeader("Authorization","Bearer "+e);f.send(r)},processWebRequest:function(n,t,i){var e,u,r,o,f;if(n.readyState===4){main.hideBusyIndicator();switch(n.status){case 200:u=n.getResponseHeader("content-type");u=u||"";e=n.responseText;u.indexOf("application/json")>-1&&(e=JSON.parse(e));t(e,i);break;case 400:if(u=n.getResponseHeader("content-type"),u=u||"",r=n.response,u.indexOf("application/json")>-1&&(r=JSON.parse(r)),r&&r.error&&r.error_description)switch(r.error){case"invalid_grant":o=document.getElementById("loginErrorMessage");o==null&&(inputDialog.showMessage("Not on login page. But expected to be on login page"),main.init());o.innerHTML=r.error_description;break;default:inputDialog.showMessage("unknown error description: "+r.error_description)}else inputDialog.showMessage(r.Message);break;case 401:navigation.showLoginPage();break;case 403:inputDialog.showMessage("You are not authorized to perform the requested action.\n"+n.statusText);break;case 500:f=JSON.parse(n.response);f=f.ExceptionMessage||f;inputDialog.showMessage("Internal Server Error:\n"+f);break;default:menuBuilder.clearNode("menuContainer");menuBuilder.clearNode("userDetail");navigation.loadHtmlBodyResponse(n.response,"mainContent")}}},showBusyIndicator1:function(){var n=document.getElementById("busyContainer");n.style.visibility="visible"},hideBusyIndicator:function(){var n=document.getElementById("busyContainer");n.style.visibility="hidden"}},menuBuilder={buildMenu:function(n){menuBuilder.clearMenu();document.getElementById("userDetail").style.display="inline";navigation.loadHtmlBody("menuContainer","Menu.html",function(){menuBuilder.clearNode("menuDiv");siteMenu.buildMenu(n)})},addMenuButton:function(n,t){var u=document.getElementById("menuDiv"),i=menuBuilder.createMenuButton(n),r=function(){i.disabled=!1},f=function(){i.disabled=!0;try{t.length>0?t(r):(t(),r())}catch(n){console.log(n+"\n"+n.stack)}};i.onclick=f;u.appendChild(i)},createMenuButton:function(n){var t=document.createElement("button");return t.innerHTML=n,t},clearMenu:function(){menuBuilder.clearNode("menuContainer");document.getElementById("loginContainer").style.visibility="hidden";document.getElementById("userDetail").style.display="none"},clearNode:function(n){for(var t=document.getElementById(n);t.firstChild;)t.removeChild(t.firstChild)}},navigation={entryPoint:function(){navigation.loadHtmlBody("mainContent","Home.html");navigation.getUserMenu()},getUserMenu:function(){main.makeWebCall(main.webApiURL+"getUserMenu","GET",navigation.processUserMenuResponse)},processUserMenuResponse:function(n){var t=n;menuBuilder.buildMenu(t)},clearSettings:function(){localStorage.removeItem(main.tokenName);localStorage.removeItem(main.userSettingName)},showLoginPage:function(){menuBuilder.clearMenu();navigation.loadHtmlBody("loginContainer","Login.html",navigation.loadLoginPageCompleted)},loadLoginPageCompleted:function(){document.getElementById("txtName").onkeypress=function(n){n.keyCode==13&&document.getElementById("txtPassword").focus()};document.getElementById("txtPassword").onkeypress=function(n){n.keyCode==13&&auth.doLogin()};document.getElementById("loginContainer").style.visibility="visible";document.getElementById("txtName").focus()},loadHtmlBody:function(n,t,i){var r="/frontend/pages/"+t+"?v="+main.version,u=function(n,t){navigation.loadHtmlBodyResponse(n,t);i&&i()};main.makeWebCall(r,"GET",u,null,n)},loadHtmlBodyResponse:function(n,t){var i=document.getElementById(t);i.innerHTML=n},getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}},siteMenu={buildMenu:function(n){var t;menuBuilder.addMenuButton("Home",function(){navigation.entryPoint()});for(t in n){var i=t,r=n[t],u=function(n){return function(){siteMenu.executeUIAction(n)}}(i);menuBuilder.addMenuButton(r,u)}},processEvent:function(n,t,i,r){var u={Data:t||"",ActionId:i};u=JSON.stringify(u);main.makeWebCall(main.webApiURL+"processEvent/"+n,"POST",siteMenu.processUIActionResponse,u,r)},executeUIAction:function(n,t){var i={Data:t||""};i=JSON.stringify(i);main.makeWebCall(main.webApiURL+"executeUIAction/"+n,"POST",siteMenu.processUIActionResponse,i,t)},processUIActionResponse:function(n,t){var f=n[0],i,r,u,e,o;n.splice(0,1);i=function(){};n.length>0&&(i=function(n){return function(){siteMenu.processUIActionResponse(n,t)}}(n));r=f;u=-1;r!=null&&r.ActionType!=null&&(u=r.ActionType);e=f;switch(u){case-1:inputDialog.showMessage(e,i,null);break;case 0:o=f.ViewData;siteMenu.populateView(o,r,null,t);i();break;case 1:siteMenu.buildInput(r,t);i();break;case 4:inputDialog.cancelInput();i();break;case 5:inputDialog.showMessage(e,i,r.Data);break;case 6:siteMenu.executeUIAction(r.EventNumber,r.ParametersToPass);i();break;default:inputDialog.showMessage("unknown action type: "+u,i,null)}},buildInput:function(n,t){inputDialog.loadInputPage("InputDialog.html",function(){var ii=document.getElementById("pageTitle"),wt,ht,bt,b,u,i,v,d,s,f,h,e,o,kt,ct,l,a,g,nt,c,lt,at,tt,dt,it,y,rt,gt,ut,ft,et,ri,p,r,vt,k;ii.innerHTML=n.Description;var yt=document.getElementById("inputTable"),w=[],pt=function(n){for(var i,t=0;t<w.length;t++)if(i=w[t],i.TriggerInputName==n)return!0;return!1};for(r=0;r<n.InputFields.length;r++)if(i=n.InputFields[r],i.VisibilityConditions!=null&&i.VisibilityConditions.length>0)for(wt=i.InputName,s=0;s<i.VisibilityConditions.length;s++)ht=i.VisibilityConditions[s],bt={InputName:wt,Condition:ht,TriggerInputName:ht.ColumnName},w.push(bt);for(b=function(n,t){var r=n.value,u,i,e,f,n;for(n.type=="checkbox"&&(r=n.checked),r=r+"",u=0;u<w.length;u++)if(i=w[u],i.TriggerInputName==t){for(e="_"+i.InputName,f=!0,i.Condition.Comparison==0?f=r===i.Condition.ColumnValue:i.Condition.Comparison==1?f=r!=i.Condition.ColumnValue:alert("Unknown comparison "+i.Condition.Comparison),n=document.getElementById(e);n.tagName!="TR";)n=n.parentNode;n.style.display=f?"":"none"}},r=0;r<n.InputFields.length;r++){u=document.createElement("tr");w.push(r);i=n.InputFields[r];switch(i.InputType){case 0:case 1:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");f.type=i.InputType==1?"password":"text";f.id="_"+i.InputName;i.DefaultValue!=null&&i.DefaultValue.length>0&&(f.value=i.DefaultValue);pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 2:inputDialog.addHiddenField("_"+i.InputName,i.DefaultValue);break;case 3:for(e=document.createElement("td"),e.innerHTML=i.InputLabel,u.appendChild(e),v=document.createElement("select"),pt(i.InputName)&&(v.onchange=function(n){return function(){b(this,n)}}(i.InputName)),v.id="_"+i.InputName,d=i.ListItems,s=0;s<d.length;s++)c=document.createElement("option"),c.value=d[s],c.text=d[s],v.appendChild(c);i.DefaultValue!=null&&i.DefaultValue.length>0&&(v.value=i.DefaultValue);h=document.createElement("td");h.appendChild(v);u.appendChild(h);break;case 4:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));f.type="checkbox";f.id="_"+i.InputName;i.DefaultValue!=null&&(f.checked=i.DefaultValue);h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 5:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);yt.appendChild(u);u=document.createElement("tr");o=document.createElement("table");o.style.fontSize="75%";o.frame="box";o.cellPadding="0";o.style.padding="0";var ot=document.createElement("tr"),st=document.createElement("tr"),ui=document.createElement("tr"),fi=document.createElement("tr"),ni=document.createElement("td");for(ni.innerHTML=i.SelectedItemsLabel,kt=document.createElement("td"),ct=document.createElement("td"),ct.innerHTML=i.AvailableItemsLabel,ot.appendChild(ni),ot.appendChild(kt),ot.appendChild(ct),l=document.createElement("select"),l.multiple=!0,l.id="_"+i.InputName+"_1",l.size=5,l.style.width="100%",a=document.createElement("select"),a.multiple=!0,a.id="_"+i.InputName+"_2",a.size=5,a.style.width="100%",g=0;g<i.ListSource.length;g++){for(nt=i.ListSource[g],c=document.createElement("option"),c.value=nt.Key,c.text=nt.Value,lt=!1,at=i.DefaultValue||[],tt=0;tt<at.length;tt++)if(dt=at[tt],dt==nt.Key){lt=!0;break}lt?l.appendChild(c):a.appendChild(c)}it=document.createElement("td");it.rowSpan=3;it.appendChild(l);st.appendChild(it);y=document.createElement("td");y.rowSpan=3;rt=document.createElement("button");rt.innerHTML="<<";rt.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",f=document.getElementById(r),i=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(rt);gt=document.createElement("br");y.appendChild(gt);ut=document.createElement("button");ut.innerHTML=">>";ut.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",i=document.getElementById(r),f=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(ut);st.appendChild(y);ft=document.createElement("td");ft.rowSpan=3;ft.appendChild(a);st.appendChild(ft);o.appendChild(ot);o.appendChild(st);o.appendChild(ui);o.appendChild(fi);et=document.createElement("td");et.colSpan=3;et.appendChild(o);u.appendChild(et);break;default:inputDialog.showMessage("Unknown input type: "+i.InputType);continue}yt.appendChild(u)}for(r=0;r<n.InputFields.length;r++){var i=n.InputFields[r],ei="_"+i.InputName,ti=document.getElementById(ei);ti!=null&&b(ti,i.InputName)}for(ri=document.createElement("tr"),p=document.createElement("td"),p.colSpan=2,r=0;r<n.InputButtons.length;r++)vt=n.InputButtons[r],k=document.createElement("button"),k.style.margin="10px",k.innerHTML=vt.Label,k.onclick=function(i,r){return function(){for(var c={},f,u,e,s,o,h=0;h<r.InputFields.length;h++){if(f=r.InputFields[h],f.InputType==5)for(e=[],u=document.getElementById("_"+f.InputName+"_1"),s=u.options,o=0;o<s.length;o++)e.push(s[o].value);else{if(u=document.getElementById("_"+f.InputName),u==null)continue;e=u.value;u.type=="checkbox"&&(e=u.checked)}c[f.InputName]=e}t!=null&&t.length>0;siteMenu.processEvent(n.Id,c,i,t)}}(vt.ActionNumber,n),p.appendChild(k);p.style.textAlign="center";p.style.verticalAlign="middle";yt.appendChild(p)})},populateView:function(n,t,i){navigation.loadHtmlBody("mainContent","Views.html",function(){var it=views.getTable(),l=document.createElement("tr"),ot=document.getElementById("viewsTitle"),w,e,o,b,rt,a,v,h,y,k,ut,u,d,s,ft;for(ot.innerHTML=t.Description,e=0;e<t.Columns.length;e++)w=document.createElement("th"),w.innerHTML=t.Columns[e].ColumnLabel,l.appendChild(w);for(it.appendChild(l),u=0;u<n.length;u++){for(l=document.createElement("tr"),e=0;e<t.Columns.length;e++){var r=t.Columns[e],c=document.createElement("td"),f="";if(r.ColumnName!=null&&r.ColumnName.length>0){for(f=n[u],o=r.ColumnName;o.indexOf(".")>-1;)b=o.indexOf("."),rt=o.substring(0,b),f=f[rt],o=o.substring(b+1);f=f[o]}if(r.ColumnType==1?(f==!0?f=r.TrueValueDisplay:f==!1&&(f=r.FalseValueDisplay),c.innerHTML=f):r.ColumnType==2?(s=document.createElement("button"),s.onclick=function(i,r){return function(){var o=n[i].Id,f=JSON.stringify(n[i]),u=t.Columns[r],e;u.Event.ActionType==5?inputDialog.showMessage(u.Event,null,f):u.Event.ActionType==6?(e=u.Event.EventNumber,f=n[i].Id,siteMenu.executeUIAction(e,f)):inputDialog.showMessage("Unknown action type "+u.Event.ActionType)}}(u,e),r.ButtonTextSource==0?s.innerHTML=r.ButtonText:(inputDialog.showMessage("Unhandled ButtonTextSource: "+r.ButtonTextSource),s.innerHTML="????"),c.appendChild(s)):r.ColumnType==3?(a=document.createElement("a"),a.href="#",a.innerHTML=r.LinkLabel,a.onclick=function(t,i){return function(){var r={Id:n[i][t.KeyColumn]},u=t.EventNumber;siteMenu.executeUIAction(u,r)}}(r,u),c.appendChild(a)):c.innerHTML=f,r.ColumnSetting!=null&&r.ColumnSetting.ColumnSettingType==0){for(v=r.ColumnSetting.Display==0,h=!0,y=0;y<r.ColumnSetting.Conditions.length;y++){var g=r.ColumnSetting.Conditions[y],o=g.ColumnName,nt=g.Comparison,et=g.ColumnValue,p=n[u][o]||"";p=p.toString();nt==0?h=h&&p==et:nt==1?h=h&&p!=et:alert("Unknown comparison: "+nt)}if(h==!1&&v==!0||h==!0&&v==!1){var v=r.ColumnSetting.Display==0,st=c.innerHTML,tt=document.createElement("div");tt.innerHTML=st;k=document.createElement("td");k.appendChild(tt);tt.style.display="none";c=k}}l.appendChild(c)}it.appendChild(l)}for(ut=document.getElementById("viewsMenu"),menuBuilder.clearNode("viewsMenu"),u=0;u<t.ViewMenu.length;u++)d=t.ViewMenu[u],s=document.createElement("button"),s.innerHTML=d.Label,s.onclick=function(n,i){return function(){var r=t.ViewMenu[i];siteMenu.executeUIAction(n,r.ParametersToPass)}}(d.EventNumber,u),ut.appendChild(s);ft=document.getElementById("viewsFooter");ft.innerHTML=t.ViewMessage!=null&&t.ViewMessage.length>0?t.ViewMessage:"";i&&i()})}},views={getTable:function(){return document.getElementById("tblView")}},auth={doLogin:function(){var n=document.getElementById("txtName").value,t=document.getElementById("txtPassword").value,i=main.webApiURL+"token",r="grant_type=password&username="+n+"&password="+t+"&client_id="+main.applicationName;main.makeWebCall(i,"POST",auth.onLoginSuccess,r)},onLoginSuccess:function(n){console.log("login success: "+n);auth.refreshTokenResponse(n);menuBuilder.clearNode("loginContainer");main.init()},makeRefreshCall:function(){var n=auth.getRefreshToken(),t;console.log(n);t="grant_type=refresh_token&client_id="+main.applicationName+"&refresh_token="+n;main.makeWebCall(main.webApiURL+"token","POST",auth.refreshTokenResponse,t)},getRefreshToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.refresh_token!=null&&(t=n.refresh_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},getAccessToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.access_token!=null&&(t=n.access_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},refreshTokenResponse:function(n){var t=n.access_token,i=n.userName;localStorage.setItem(main.tokenName,JSON.stringify(n));auth.startRefreshTimer()},startRefreshTimer:function(){var n=localStorage.getItem(main.tokenName),t;n=JSON.parse(n);t=n[".expires"];t=new Date(t);var i=Math.abs(new Date-t)-5e3,r=i,u=n.refresh_token;setTimeout(auth.refreshTokenHandler,r)},refreshTokenHandler:function(){auth.makeRefreshCall()},clearRefreshTokenHandler:function(){clearTimeout(auth.refreshTokenHandler)},logout:function(){auth.clearRefreshTokenHandler();navigation.clearSettings();main.init()}},inputDialog={loadInputPage:function(n,t){menuBuilder.clearNode("dlgInput");document.getElementById("inputContent").style.display="inline";t=t||function(){};var i=function(){t()};navigation.loadHtmlBody("dlgInput",n,i)},cancelInput:function(){document.getElementById("inputContent").style.display="none";menuBuilder.clearNode("dlgInput")},addHiddenField:function(n,t){var r=document.getElementById("dlgInput"),i=document.createElement("input");i.type="hidden";i.value=t;i.id=n;r.appendChild(i)},getHiddenField:function(n){var t=document.getElementById(n);return t==null?"":t.value},cancelMessage:function(){document.getElementById("messageContent").style.display="none";menuBuilder.clearNode("dlgMessage")},showMessage:function(n,t,i){menuBuilder.clearNode("dlgMessage");var r=n.ConfirmationMessage;r==null&&(r=n);r=r||"";r=r.toString().replace(/\n/g,"<br/>");document.getElementById("messageContent").style.display="inline";navigation.loadHtmlBody("dlgMessage","MessageDialog.html",function(){var v=document.getElementById("msgPageTitle"),f,e,s,h,c,u;v.innerHTML="Message";var l=document.getElementById("msgTable"),a=document.createElement("tr"),o=document.createElement("td");o.colSpan=2;o.innerHTML=r;o.style.textAlign="center";a.appendChild(o);l.appendChild(a);f=document.createElement("tr");e=!1;n.ConfirmationButtonText!=null&&n.ConfirmationButtonText.length>0&&(s=function(){n.OnConfirmationUIAction>0&&siteMenu.executeUIAction(n.OnConfirmationUIAction,i);t!=null&&t()},u=inputDialog.createInputDialogButton(n.ConfirmationButtonText,s),f.appendChild(u),e=!0);n.CancelButtonText!=null&&n.CancelButtonText.length>0&&(h=function(){n.OnCancelUIAction>0&&siteMenu.executeUIAction(n.OnCancelUIAction,i);t!=null&&e==!1&&t()},u=inputDialog.createInputDialogButton(n.CancelButtonText,h),f.appendChild(u),e=!0);e==!1&&(c=function(){inputDialog.cancelInput();t!=null&&t()},u=inputDialog.createInputDialogButton("Ok",c),f.appendChild(u));l.appendChild(f)})},createInputDialogButton:function(n,t){var r=document.createElement("td"),i;return r.style.textAlign="center",i=document.createElement("button"),i.innerHTML=n,i.onclick=function(){inputDialog.cancelMessage();t&&t()},r.appendChild(i),r}},main={applicationName:"websiteTemplate",baseURL:"",webApiURL:"api/v1/",menuApiUrl:"",tokenNameSuffix:"UserToken",tokenName:"",userSettingSuffix:"UserSetting",userSettingName:"",version:"0.0.3",scriptLoaded:!1,bodyOnLoad:function(){main.baseURL="https://"+window.location.host+window.location.pathname;main.init()},init:function(){var t,n,i;menuBuilder.clearMenu();document.title=main.applicationName;main.tokenName=main.applicationName+"_"+main.tokenNameSuffix+"_"+main.version;main.userSettingName=main.applicationName+"_"+main.userSettingSuffix+"_"+main.version;main.menuApiUrl=main.webApiURL+"menu/";t=navigation.getParameterByName("confirmed");t!=null&&t.length>0&&(inputDialog.showMessage("Email for "+t+" successfully confirmed.\nYou can now log in with the credentials for "+t),n=window.location.href,i=n.lastIndexOf("?"),n=n.substring(0,i),window.history.pushState(n,main.applicationName,n));main.makeWebCall(main.webApiURL+"initialize","GET",main.processInitResponse)},processInitResponse:function(n){var t=n;document.getElementById("aUserName").innerHTML=t.User;navigation.entryPoint(t);auth.startRefreshTimer()},makeWebCall:function(n,t,i,r,u){var f,e;main.showBusyIndicator1();t=t||"GET";f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){main.processWebRequest(f,i,u)};n=main.baseURL+n;f.open(t,n,!0);e=auth.getAccessToken();f.setRequestHeader("Authorization","Bearer "+e);f.send(r)},processWebRequest:function(n,t,i){var e,u,r,o,f;if(n.readyState===4){main.hideBusyIndicator();switch(n.status){case 200:u=n.getResponseHeader("content-type");u=u||"";e=n.responseText;u.indexOf("application/json")>-1&&(e=JSON.parse(e));t(e,i);break;case 400:if(u=n.getResponseHeader("content-type"),u=u||"",r=n.response,u.indexOf("application/json")>-1&&(r=JSON.parse(r)),r&&r.error&&r.error_description)switch(r.error){case"invalid_grant":o=document.getElementById("loginErrorMessage");o==null&&(inputDialog.showMessage("Not on login page. But expected to be on login page"),main.init());o.innerHTML=r.error_description;break;default:inputDialog.showMessage("unknown error description: "+r.error_description)}else inputDialog.showMessage(r.Message);break;case 401:navigation.showLoginPage();break;case 403:inputDialog.showMessage("You are not authorized to perform the requested action.\n"+n.statusText);break;case 500:f=JSON.parse(n.response);f=f.ExceptionMessage||f;inputDialog.showMessage("Internal Server Error:\n"+f);break;default:menuBuilder.clearNode("menuContainer");menuBuilder.clearNode("userDetail");navigation.loadHtmlBodyResponse(n.response,"mainContent")}}},showBusyIndicator1:function(){var n=document.getElementById("busyContainer");n.style.visibility="visible"},hideBusyIndicator:function(){var n=document.getElementById("busyContainer");n.style.visibility="hidden"}},menuBuilder={buildMenu:function(n){menuBuilder.clearMenu();document.getElementById("userDetail").style.display="inline";navigation.loadHtmlBody("menuContainer","Menu.html",function(){menuBuilder.clearNode("menuDiv");siteMenu.buildMenu(n)})},addMenuButton:function(n,t){var u=document.getElementById("menuDiv"),i=menuBuilder.createMenuButton(n),r=function(){i.disabled=!1},f=function(){i.disabled=!0;try{t.length>0?t(r):(t(),r())}catch(n){console.log(n+"\n"+n.stack)}};i.onclick=f;u.appendChild(i)},createMenuButton:function(n){var t=document.createElement("button");return t.innerHTML=n,t},clearMenu:function(){menuBuilder.clearNode("menuContainer");document.getElementById("loginContainer").style.visibility="hidden";document.getElementById("userDetail").style.display="none"},clearNode:function(n){for(var t=document.getElementById(n);t.firstChild;)t.removeChild(t.firstChild)}},navigation={entryPoint:function(){navigation.loadHtmlBody("mainContent","Home.html");navigation.getUserMenu()},getUserMenu:function(){main.makeWebCall(main.webApiURL+"getUserMenu","GET",navigation.processUserMenuResponse)},processUserMenuResponse:function(n){var t=n;menuBuilder.buildMenu(t)},clearSettings:function(){localStorage.removeItem(main.tokenName);localStorage.removeItem(main.userSettingName)},showLoginPage:function(){menuBuilder.clearMenu();navigation.loadHtmlBody("loginContainer","Login.html",navigation.loadLoginPageCompleted)},loadLoginPageCompleted:function(){document.getElementById("txtName").onkeypress=function(n){n.keyCode==13&&document.getElementById("txtPassword").focus()};document.getElementById("txtPassword").onkeypress=function(n){n.keyCode==13&&auth.doLogin()};document.getElementById("loginContainer").style.visibility="visible";document.getElementById("txtName").focus()},loadHtmlBody:function(n,t,i){var r="/frontend/pages/"+t+"?v="+main.version,u=function(n,t){navigation.loadHtmlBodyResponse(n,t);i&&i()};main.makeWebCall(r,"GET",u,null,n)},loadHtmlBodyResponse:function(n,t){var i=document.getElementById(t);i.innerHTML=n},getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}},siteMenu={buildMenu:function(n){var t;menuBuilder.addMenuButton("Home",function(){navigation.entryPoint()});for(t in n){var i=t,r=n[t],u=function(n){return function(){siteMenu.executeUIAction(n)}}(i);menuBuilder.addMenuButton(r,u)}},processEvent:function(n,t,i,r){var u={Data:t||"",ActionId:i};u=JSON.stringify(u);main.makeWebCall(main.webApiURL+"processEvent/"+n,"POST",siteMenu.processUIActionResponse,u,r)},executeUIAction:function(n,t){var i={Data:t||""};i=JSON.stringify(i);main.makeWebCall(main.webApiURL+"executeUIAction/"+n,"POST",siteMenu.processUIActionResponse,i,t)},processUIActionResponse:function(n,t){var f=n[0],i,r,u,e,o;n.splice(0,1);i=function(){};n.length>0&&(i=function(n){return function(){siteMenu.processUIActionResponse(n,t)}}(n));r=f;u=-1;r!=null&&r.ActionType!=null&&(u=r.ActionType);e=f;switch(u){case-1:inputDialog.showMessage(e,i,null);break;case 0:o=f.ViewData;siteMenu.populateView(o,r,null,t);i();break;case 1:siteMenu.buildInput(r,t);i();break;case 4:inputDialog.cancelInput();i();break;case 5:inputDialog.showMessage(e,i,r.Data);break;case 6:siteMenu.executeUIAction(r.EventNumber,r.ParametersToPass);i();break;default:inputDialog.showMessage("unknown action type: "+u,i,null)}},buildInput:function(n,t){inputDialog.loadInputPage("InputDialog.html",function(){var ii=document.getElementById("pageTitle"),wt,ht,bt,b,u,i,v,d,s,f,h,e,o,kt,ct,l,a,g,nt,c,lt,at,tt,dt,it,y,rt,gt,ut,ft,et,ri,p,r,vt,k;ii.innerHTML=n.Description;var yt=document.getElementById("inputTable"),w=[],pt=function(n){for(var i,t=0;t<w.length;t++)if(i=w[t],i.TriggerInputName==n)return!0;return!1};for(r=0;r<n.InputFields.length;r++)if(i=n.InputFields[r],i.VisibilityConditions!=null&&i.VisibilityConditions.length>0)for(wt=i.InputName,s=0;s<i.VisibilityConditions.length;s++)ht=i.VisibilityConditions[s],bt={InputName:wt,Condition:ht,TriggerInputName:ht.ColumnName},w.push(bt);for(b=function(n,t){var r=n.value,u,i,e,f,n;for(n.type=="checkbox"&&(r=n.checked),r=r+"",u=0;u<w.length;u++)if(i=w[u],i.TriggerInputName==t){for(e="_"+i.InputName,f=!0,i.Condition.Comparison==0?f=r===i.Condition.ColumnValue:i.Condition.Comparison==1?f=r!=i.Condition.ColumnValue:alert("Unknown comparison "+i.Condition.Comparison),n=document.getElementById(e);n.tagName!="TR";)n=n.parentNode;n.style.display=f?"":"none"}},r=0;r<n.InputFields.length;r++){u=document.createElement("tr");w.push(r);i=n.InputFields[r];switch(i.InputType){case 0:case 1:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");f.type=i.InputType==1?"password":"text";f.id="_"+i.InputName;i.DefaultValue!=null&&i.DefaultValue.length>0&&(f.value=i.DefaultValue);pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 2:inputDialog.addHiddenField("_"+i.InputName,i.DefaultValue);break;case 3:for(e=document.createElement("td"),e.innerHTML=i.InputLabel,u.appendChild(e),v=document.createElement("select"),pt(i.InputName)&&(v.onchange=function(n){return function(){b(this,n)}}(i.InputName)),v.id="_"+i.InputName,d=i.ListItems,s=0;s<d.length;s++)c=document.createElement("option"),c.value=d[s],c.text=d[s],v.appendChild(c);i.DefaultValue!=null&&i.DefaultValue.length>0&&(v.value=i.DefaultValue);h=document.createElement("td");h.appendChild(v);u.appendChild(h);break;case 4:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);f=document.createElement("input");pt(i.InputName)&&(f.onchange=function(n){return function(){b(this,n)}}(i.InputName));f.type="checkbox";f.id="_"+i.InputName;i.DefaultValue!=null&&(f.checked=i.DefaultValue);h=document.createElement("td");h.appendChild(f);u.appendChild(h);break;case 5:e=document.createElement("td");e.innerHTML=i.InputLabel;u.appendChild(e);yt.appendChild(u);u=document.createElement("tr");o=document.createElement("table");o.style.fontSize="75%";o.frame="box";o.cellPadding="0";o.style.padding="0";var ot=document.createElement("tr"),st=document.createElement("tr"),ui=document.createElement("tr"),fi=document.createElement("tr"),ni=document.createElement("td");for(ni.innerHTML=i.SelectedItemsLabel,kt=document.createElement("td"),ct=document.createElement("td"),ct.innerHTML=i.AvailableItemsLabel,ot.appendChild(ni),ot.appendChild(kt),ot.appendChild(ct),l=document.createElement("select"),l.multiple=!0,l.id="_"+i.InputName+"_1",l.size=5,l.style.width="100%",a=document.createElement("select"),a.multiple=!0,a.id="_"+i.InputName+"_2",a.size=5,a.style.width="100%",g=0;g<i.ListSource.length;g++){for(nt=i.ListSource[g],c=document.createElement("option"),c.value=nt.Key,c.text=nt.Value,lt=!1,at=i.DefaultValue||[],tt=0;tt<at.length;tt++)if(dt=at[tt],dt==nt.Key){lt=!0;break}lt?l.appendChild(c):a.appendChild(c)}it=document.createElement("td");it.rowSpan=3;it.appendChild(l);st.appendChild(it);y=document.createElement("td");y.rowSpan=3;rt=document.createElement("button");rt.innerHTML="<<";rt.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",f=document.getElementById(r),i=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(rt);gt=document.createElement("br");y.appendChild(gt);ut=document.createElement("button");ut.innerHTML=">>";ut.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",i=document.getElementById(r),f=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(i.InputName);y.appendChild(ut);st.appendChild(y);ft=document.createElement("td");ft.rowSpan=3;ft.appendChild(a);st.appendChild(ft);o.appendChild(ot);o.appendChild(st);o.appendChild(ui);o.appendChild(fi);et=document.createElement("td");et.colSpan=3;et.appendChild(o);u.appendChild(et);break;default:inputDialog.showMessage("Unknown input type: "+i.InputType);continue}yt.appendChild(u)}for(r=0;r<n.InputFields.length;r++){var i=n.InputFields[r],ei="_"+i.InputName,ti=document.getElementById(ei);ti!=null&&b(ti,i.InputName)}for(ri=document.createElement("tr"),p=document.createElement("td"),p.colSpan=2,r=0;r<n.InputButtons.length;r++)vt=n.InputButtons[r],k=document.createElement("button"),k.style.margin="10px",k.innerHTML=vt.Label,k.onclick=function(i,r){return function(){for(var c={},f,u,e,s,o,h=0;h<r.InputFields.length;h++){if(f=r.InputFields[h],f.InputType==5)for(e=[],u=document.getElementById("_"+f.InputName+"_1"),s=u.options,o=0;o<s.length;o++)e.push(s[o].value);else{if(u=document.getElementById("_"+f.InputName),u==null)continue;e=u.value;u.type=="checkbox"&&(e=u.checked)}c[f.InputName]=e}t!=null&&t.length>0;siteMenu.processEvent(n.Id,c,i,t)}}(vt.ActionNumber,n),p.appendChild(k);p.style.textAlign="center";p.style.verticalAlign="middle";yt.appendChild(p)})},populateView:function(n,t,i){navigation.loadHtmlBody("mainContent","Views.html",function(){var it=views.getTable(),l=document.createElement("tr"),ot=document.getElementById("viewsTitle"),w,e,o,b,rt,a,v,h,y,k,ut,u,d,s,ft;for(ot.innerHTML=t.Description,e=0;e<t.Columns.length;e++)w=document.createElement("th"),w.innerHTML=t.Columns[e].ColumnLabel,l.appendChild(w);for(it.appendChild(l),u=0;u<n.length;u++){for(l=document.createElement("tr"),e=0;e<t.Columns.length;e++){var r=t.Columns[e],c=document.createElement("td"),f="";if(r.ColumnName!=null&&r.ColumnName.length>0){for(f=n[u],o=r.ColumnName;o.indexOf(".")>-1;)b=o.indexOf("."),rt=o.substring(0,b),f=f[rt],o=o.substring(b+1);f=f[o]}if(r.ColumnType==1?(f==!0?f=r.TrueValueDisplay:f==!1&&(f=r.FalseValueDisplay),c.innerHTML=f):r.ColumnType==2?(s=document.createElement("button"),s.onclick=function(i,r){return function(){var o=n[i].Id,f=JSON.stringify(n[i]),u=t.Columns[r],e;u.Event.ActionType==5?inputDialog.showMessage(u.Event,null,f):u.Event.ActionType==6?(e=u.Event.EventNumber,f=n[i].Id,siteMenu.executeUIAction(e,f)):inputDialog.showMessage("Unknown action type "+u.Event.ActionType)}}(u,e),r.ButtonTextSource==0?s.innerHTML=r.ButtonText:(inputDialog.showMessage("Unhandled ButtonTextSource: "+r.ButtonTextSource),s.innerHTML="????"),c.appendChild(s)):r.ColumnType==3?(a=document.createElement("a"),a.href="#",a.innerHTML=r.LinkLabel,a.onclick=function(t,i){return function(){var r={Id:n[i][t.KeyColumn]},u=t.EventNumber;siteMenu.executeUIAction(u,r)}}(r,u),c.appendChild(a)):c.innerHTML=f,r.ColumnSetting!=null&&r.ColumnSetting.ColumnSettingType==0){for(v=r.ColumnSetting.Display==0,h=!0,y=0;y<r.ColumnSetting.Conditions.length;y++){var g=r.ColumnSetting.Conditions[y],o=g.ColumnName,nt=g.Comparison,et=g.ColumnValue,p=n[u][o]||"";p=p.toString();nt==0?h=h&&p==et:nt==1?h=h&&p!=et:alert("Unknown comparison: "+nt)}if(h==!1&&v==!0||h==!0&&v==!1){var v=r.ColumnSetting.Display==0,st=c.innerHTML,tt=document.createElement("div");tt.innerHTML=st;k=document.createElement("td");k.appendChild(tt);tt.style.display="none";c=k}}l.appendChild(c)}it.appendChild(l)}for(ut=document.getElementById("viewsMenu"),menuBuilder.clearNode("viewsMenu"),u=0;u<t.ViewMenu.length;u++)d=t.ViewMenu[u],s=document.createElement("button"),s.innerHTML=d.Label,s.onclick=function(n,i){return function(){var r=t.ViewMenu[i];siteMenu.executeUIAction(n,r.ParametersToPass)}}(d.EventNumber,u),ut.appendChild(s);ft=document.getElementById("viewsFooter");ft.innerHTML=t.ViewMessage!=null&&t.ViewMessage.length>0?t.ViewMessage:"";i&&i()})}},views={getTable:function(){return document.getElementById("tblView")}};
