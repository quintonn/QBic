;
var auth={doLogin:function(){var n=document.getElementById("txtName").value,t=document.getElementById("txtPassword").value,i=main.webApiURL+"token",r="grant_type=password&username="+n+"&password="+t+"&client_id="+main.applicationName;main.makeWebCall(i,"POST",auth.onLoginSuccess,r)},onLoginSuccess:function(n){console.log("login success: "+n);auth.refreshTokenResponse(n);menuBuilder.clearNode("loginContainer");main.init()},makeRefreshCall:function(){var n=auth.getRefreshToken(),t;console.log(n);t="grant_type=refresh_token&client_id="+main.applicationName+"&refresh_token="+n;main.makeWebCall(main.webApiURL+"token","POST",auth.refreshTokenResponse,t)},getRefreshToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.refresh_token!=null&&(t=n.refresh_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},getAccessToken:function(){var n,t;try{return n=localStorage.getItem(main.tokenName),n=n||"",n.length>0&&(n=JSON.parse(n)),t="",n!=null&&n.access_token!=null&&(t=n.access_token),t}catch(i){inputDialog.showMessage(i+"\n"+i.stack);localStorage.removeItem(main.tokenName)}},refreshTokenResponse:function(n){var t=n.access_token,i=n.userName;localStorage.setItem(main.tokenName,JSON.stringify(n));auth.startRefreshTimer()},startRefreshTimer:function(){var n=localStorage.getItem(main.tokenName),t;n=JSON.parse(n);t=n[".expires"];t=new Date(t);var i=Math.abs(new Date-t)-5e3,r=i,u=n.refresh_token;setTimeout(auth.refreshTokenHandler,r)},refreshTokenHandler:function(){auth.makeRefreshCall()},clearRefreshTokenHandler:function(){clearTimeout(auth.refreshTokenHandler)},logout:function(){auth.clearRefreshTokenHandler();navigation.clearSettings();main.init()}};
var inputDialog={loadInputPage:function(n,t){menuBuilder.clearNode("dlgInput");document.getElementById("inputContent").style.display="inline";t=t||function(){};var i=function(){t()};navigation.loadHtmlBody("dlgInput",n,i)},cancelInput:function(){document.getElementById("inputContent").style.display="none";menuBuilder.clearNode("dlgInput")},addHiddenField:function(n,t){var r=document.getElementById("dlgInput"),i=document.createElement("input");i.type="hidden";i.value=t;i.id=n;r.appendChild(i)},getHiddenField:function(n){var t=document.getElementById(n);return t==null?"":t.value},cancelMessage:function(){document.getElementById("messageContent").style.display="none";menuBuilder.clearNode("dlgMessage")},showMessage:function(n,t,i){alert("todo: be able to show many input dialogs without affecting each other");menuBuilder.clearNode("dlgMessage");var r=n.ConfirmationMessage;r==null&&(r=n);r=r||"";r=r.toString().replace(/\n/g,"<br/>");document.getElementById("messageContent").style.display="inline";navigation.loadHtmlBody("dlgMessage","MessageDialog.html",function(){var p=document.getElementById("msgPageTitle"),f,e,a,v,y,u,s,h;p.innerHTML="Message";var c=document.getElementById("msgTable"),l=document.createElement("tr"),o=document.createElement("td");o.colSpan=2;o.innerHTML=r;o.style.textAlign="center";l.appendChild(o);c.appendChild(l);f=document.createElement("tr");e=!1;n.ConfirmationButtonText!=null&&n.ConfirmationButtonText.length>0&&(a=function(){n.OnConfirmationUIAction>0&&siteMenu.executeUIAction(n.OnConfirmationUIAction,i);t!=null&&t()},u=inputDialog.createInputDialogButton(n.ConfirmationButtonText,a),f.appendChild(u),e=!0);n.CancelButtonText!=null&&n.CancelButtonText.length>0&&(v=function(){n.OnCancelUIAction>0&&siteMenu.executeUIAction(n.OnCancelUIAction,i);t!=null&&e==!1&&t()},u=inputDialog.createInputDialogButton(n.CancelButtonText,v),f.appendChild(u),e=!0);e==!1&&(y=function(){inputDialog.cancelInput();t!=null&&t()},u=inputDialog.createInputDialogButton("Ok",y),f.appendChild(u));c.appendChild(f);s=null;h=f.children[0];h!=null&&(s=h.children[0]);s!=null&&s.focus()})},createInputDialogButton:function(n,t){var r=document.createElement("td"),i;return r.style.textAlign="center",i=document.createElement("button"),i.innerHTML=n,i.onclick=function(){inputDialog.cancelMessage();t&&t()},r.appendChild(i),r}};
var main={applicationName:"",baseURL:"",webApiURL:"api/v1/",menuApiUrl:"",tokenNameSuffix:"UserToken",tokenName:"",userSettingSuffix:"UserSetting",userSettingName:"",version:"0.0.3",scriptLoaded:!1,bodyOnLoad:function(){main.baseURL="https://"+window.location.host+window.location.pathname;main.initSystem()},initSystem:function(){main.makeWebCall(main.webApiURL+"initializeSystem","GET",main.processInitSystemResponse)},processInitSystemResponse:function(n){var t=n;main.applicationName=t.ApplicationName;main.init()},init:function(){var t,n,i;menuBuilder.clearMenu();document.title=main.applicationName;main.tokenName=main.applicationName+"_"+main.tokenNameSuffix+"_"+main.version;main.userSettingName=main.applicationName+"_"+main.userSettingSuffix+"_"+main.version;main.menuApiUrl=main.webApiURL+"menu/";t=navigation.getParameterByName("confirmed");t!=null&&t.length>0&&(inputDialog.showMessage("Email for "+t+" successfully confirmed.\nYou can now log in with the credentials for "+t),n=window.location.href,i=n.lastIndexOf("?"),n=n.substring(0,i),window.history.pushState(n,main.applicationName,n));main.makeWebCall(main.webApiURL+"initialize","GET",main.processInitResponse)},processInitResponse:function(n){var t=n;document.getElementById("aUserName").innerHTML=t.User;navigation.entryPoint(t);auth.startRefreshTimer()},makeWebCall:function(n,t,i,r,u){var f,e;main.showBusyIndicator1();t=t||"GET";f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){main.processWebRequest(f,i,u)};n=main.baseURL+n;f.open(t,n,!0);e=auth.getAccessToken();f.setRequestHeader("Authorization","Bearer "+e);f.send(r)},processWebRequest:function(n,t,i){var e,u,r,o,f;if(n.readyState===4){main.hideBusyIndicator();switch(n.status){case 200:u=n.getResponseHeader("content-type");u=u||"";e=n.responseText;u.indexOf("application/json")>-1&&(e=JSON.parse(e));t(e,i);break;case 400:if(u=n.getResponseHeader("content-type"),u=u||"",r=n.response,u.indexOf("application/json")>-1&&(r=JSON.parse(r)),r&&r.error&&r.error_description)switch(r.error){case"invalid_grant":o=document.getElementById("loginErrorMessage");o==null&&(inputDialog.showMessage("Not on login page. But expected to be on login page"),main.init());o.innerHTML=r.error_description;break;default:inputDialog.showMessage("unknown error description: "+r.error_description)}else inputDialog.showMessage(r.Message);break;case 401:navigation.showLoginPage();break;case 403:inputDialog.showMessage("You are not authorized to perform the requested action.\n"+n.statusText);break;case 500:f=JSON.parse(n.response);f=f.ExceptionMessage||f;inputDialog.showMessage("Internal Server Error:\n"+f);break;default:menuBuilder.clearNode("menuContainer");menuBuilder.clearNode("userDetail");navigation.loadHtmlBodyResponse(n.response,"mainContent")}}},showBusyIndicator1:function(){var n=document.getElementById("busyContainer");n.style.visibility="visible"},hideBusyIndicator:function(){var n=document.getElementById("busyContainer");n.style.visibility="hidden"}};
/**
 * AW Masked Input
 * @version 1.4
 * @author Kendall Conrad
 * @url http://www.angelwatt.com/coding/masked_input.php
 * @created 2008-12-16
 * @modified 2015-02-25
 * @license This work is licensed under a Creative Commons
 *  Attribution-Share Alike 3.0 United States License
 *  http://creativecommons.org/licenses/by-sa/3.0/us/
 *
 * @param scope The object to attach MaskedInput to.
 */
(function(n){"use strict";n.MaskedInput=function(t){if(!t||!t.elm||!t.format)return null;if(!(this instanceof n.MaskedInput))return new n.MaskedInput(t);var r=this,i=t.elm,u=t.format,e=t.allowed||"0123456789",g=t.allowedfx||function(){return!0},c=t.separator||"/:-",o=t.typeon||"_YMDhms",v=t.onbadkey||function(){},y=t.onfilled||function(){},nt=t.badkeywait||0,tt=t.hasOwnProperty("preserve")?!!t.preserve:!0,l=!0,s=!1,p=u,h=function(){return window.addEventListener?function(n,t,i,r){n.addEventListener(t,i,r===undefined?!1:r)}:window.attachEvent?function(n,t,i){n.attachEvent("on"+t,i)}:function(n,t,i){n["on"+t]=i}}(),w=function(){for(var t,r,n=i.value.length-1;n>=0;n--)for(t=0,r=o.length;t<r;t++)if(i.value[n]===o[t])return!1;return!0},b=function(n){try{if(n.focus(),n.selectionStart>=0)return n.selectionStart;if(document.selection){var t=document.selection.createRange();return-t.moveStart("character",-n.value.length)}return-1}catch(i){return-1}},a=function(n,t){try{if(n.selectionStart)n.focus(),n.setSelectionRange(t,t);else if(n.createTextRange){var i=n.createTextRange();i.move("character",t);i.select()}}catch(r){return!1}return!0},k=function(n){n=n||window.event;var i="",t=n.which,r=n.type;if((t===undefined||t===null)&&(t=n.keyCode),t===undefined||t===null)return"";switch(t){case 8:i="bksp";break;case 46:i=r==="keydown"?"del":".";break;case 16:i="shift";break;case 0:case 9:case 13:i="etc";break;case 37:case 38:case 39:case 40:i=!n.shiftKey&&n.charCode!==39&&n.charCode!==undefined?"etc":String.fromCharCode(t);break;default:i=String.fromCharCode(t)}return i},f=function(n,t){n.preventDefault&&n.preventDefault();n.returnValue=t||!1},d=function(n){var t=b(i),r=i.value,f="";switch(!0){case e.indexOf(n)!==-1:if(t=t+1,t>u.length)return!1;while(c.indexOf(r.charAt(t-1))!==-1&&t<=u.length)t=t+1;if(!g(n,t))return v(n),!1;f=r.substr(0,t-1)+n+r.substr(t);e.indexOf(r.charAt(t))===-1&&o.indexOf(r.charAt(t))===-1&&(t=t+1);break;case n==="bksp":if(t=t-1,t<0)return!1;while(e.indexOf(r.charAt(t))===-1&&o.indexOf(r.charAt(t))===-1&&t>1)t=t-1;f=r.substr(0,t)+u.substr(t,1)+r.substr(t+1);break;case n==="del":if(t>=r.length)return!1;while(c.indexOf(r.charAt(t))!==-1&&r.charAt(t)!=="")t=t+1;f=r.substr(0,t)+u.substr(t,1)+r.substr(t+1);t=t+1;break;case n==="etc":return!0;default:return!1}return i.value="",i.value=f,a(i,t),!1},it=function(n){if(e.indexOf(n)===-1&&n!=="bksp"&&n!=="del"&&n!=="etc"){var t=b(i);return s=!0,v(n),setTimeout(function(){s=!1;a(i,t)},nt),!1}return!0},rt=function(n){if(!l)return!0;if(n=n||event,s)return f(n),!1;var t=k(n);return(n.metaKey||n.ctrlKey)&&(t==="X"||t==="V")?(f(n),!1):n.metaKey||n.ctrlKey?!0:(i.value===""&&(i.value=u,a(i,0)),t==="bksp"||t==="del")?(d(t),f(n),!1):!0},ut=function(n){if(!l)return!0;if(n=n||event,s)return f(n),!1;var t=k(n);return t==="etc"||n.metaKey||n.ctrlKey||n.altKey?!0:t!=="bksp"&&t!=="del"&&t!=="shift"?it(t)?d(t)?(w()&&y(),f(n,!0),!0):(w()&&y(),f(n),!1):(f(n),!1):!1},ft=function(){return!i.tagName||i.tagName.toUpperCase()!=="INPUT"&&i.tagName.toUpperCase()!=="TEXTAREA"?null:(tt&&i.value!==""||(i.value=u),h(i,"keydown",function(n){rt(n)}),h(i,"keypress",function(n){ut(n)}),h(i,"focus",function(){p=i.value}),h(i,"blur",function(){i.value!==p&&i.onchange&&i.onchange()}),r)};return r.resetField=function(){i.value=u},r.setAllowed=function(n){e=n;r.resetField()},r.setFormat=function(n){u=n;r.resetField()},r.setSeparator=function(n){c=n;r.resetField()},r.setTypeon=function(n){o=n;r.resetField()},r.setEnabled=function(n){l=n},ft()}})(window);
var menuBuilder={buildMenu:function(n){menuBuilder.clearMenu();document.getElementById("userDetail").style.display="inline";navigation.loadHtmlBody("menuContainer","Menu.html",function(){menuBuilder.clearNode("menuDiv");siteMenu.buildMenu(n)})},createSubMenu:function(n,t){menuBuilder.clearNode("menuDiv");siteMenu.buildMenu(n,t)},addMenuButton:function(n,t){var u=document.getElementById("menuDiv"),i=menuBuilder.createMenuButton(n),r=function(){i.disabled=!1},f=function(){i.disabled=!0;try{t.length>0?t(r):(t(),r())}catch(n){console.log(n+"\n"+n.stack)}};i.onclick=f;u.appendChild(i)},createMenuButton:function(n){var t=document.createElement("button");return t.innerHTML=n,t},clearMenu:function(){menuBuilder.clearNode("menuContainer");document.getElementById("loginContainer").style.visibility="hidden";document.getElementById("userDetail").style.display="none"},clearNode:function(n){for(var t=document.getElementById(n);t.firstChild;)t.removeChild(t.firstChild)}};
/*! modernizr 3.2.0 (Custom Build) | MIT *
 * http://modernizr.com/download/?-inputtypes-setclasses !*/
!function(n,t,i){function a(n,t){return typeof n===t}function v(){var i,n,u,f,o,h,t,s;for(s in e)if(e.hasOwnProperty(s)){if(i=[],n=e[s],n.name&&(i.push(n.name.toLowerCase()),n.options&&n.options.aliases&&n.options.aliases.length))for(u=0;u<n.options.aliases.length;u++)i.push(n.options.aliases[u].toLowerCase());for(f=a(n.fn,"function")?n.fn():n.fn,o=0;o<i.length;o++)h=i[o],t=h.split("."),1===t.length?r[t[0]]=f:(!r[t[0]]||r[t[0]]instanceof Boolean||(r[t[0]]=new Boolean(r[t[0]])),r[t[0]][t[1]]=f),c.push((f?"":"no-")+t.join("-"))}}function y(n){var t=f.className,i=r._config.classPrefix||"",u;(h&&(t=t.baseVal),r._config.enableJSClass)&&(u=new RegExp("(^|\\s)"+i+"no-js(\\s|$)"),t=t.replace(u,"$1"+i+"js$2"));r._config.enableClasses&&(t+=" "+i+n.join(" "+i),h?f.className.baseVal=t:f.className=t)}function p(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):h?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}var c=[],e=[],s={_version:"3.2.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(n,t){var i=this;setTimeout(function(){t(i[n])},0)},addTest:function(n,t,i){e.push({name:n,fn:t,options:i})},addAsyncTest:function(n){e.push({name:null,fn:n})}},r=function(){},o;r.prototype=s;r=new r;var f=t.documentElement,h="svg"===f.nodeName.toLowerCase(),u=p("input"),w="search tel url email datetime date month week time datetime-local number range color".split(" "),l={};for(r.inputtypes=function(n){for(var e,s,r,c=n.length,h="1)",o=0;c>o;o++)u.setAttribute("type",e=n[o]),r="text"!==u.type&&"style"in u,r&&(u.value=h,u.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(e)&&u.style.WebkitAppearance!==i?(f.appendChild(u),s=t.defaultView,r=s.getComputedStyle&&"textfield"!==s.getComputedStyle(u,null).WebkitAppearance&&0!==u.offsetHeight,f.removeChild(u)):/^(search|tel)$/.test(e)||(r=/^(url|email)$/.test(e)?u.checkValidity&&u.checkValidity()===!1:u.value!=h)),l[n[o]]=!!r;return l}(w),v(),y(c),delete s.addTest,delete s.addAsyncTest,o=0;o<r._q.length;o++)r._q[o]();n.Modernizr=r}(window,document);
var navigation={entryPoint:function(){navigation.loadHtmlBody("mainContent","Home.html");navigation.getUserMenu()},getUserMenu:function(){main.makeWebCall(main.webApiURL+"getUserMenu","GET",navigation.processUserMenuResponse)},processUserMenuResponse:function(n){var t=n;menuBuilder.buildMenu(t)},clearSettings:function(){localStorage.removeItem(main.tokenName);localStorage.removeItem(main.userSettingName)},showLoginPage:function(){menuBuilder.clearMenu();navigation.loadHtmlBody("loginContainer","Login.html",navigation.loadLoginPageCompleted)},loadLoginPageCompleted:function(){document.getElementById("txtName").onkeypress=function(n){n.keyCode==13&&document.getElementById("txtPassword").focus()};document.getElementById("txtPassword").onkeypress=function(n){n.keyCode==13&&auth.doLogin()};document.getElementById("loginContainer").style.visibility="visible";document.getElementById("txtName").focus()},loadHtmlBody:function(n,t,i){var r="/frontend/pages/"+t+"?v="+main.version,u=function(n,t){navigation.loadHtmlBodyResponse(n,t);i&&i()};main.makeWebCall(r,"GET",u,null,n)},loadHtmlBodyResponse:function(n,t){var i=document.getElementById(t);i.innerHTML=n},getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}};
var siteMenu={findMenu:function(n,t){var u,i,r;for(u in t){if(i=t[u],i.Id==n)return i.SubMenus;if(r=siteMenu.findMenu(n,i.SubMenus),r!=null)return r}return null},buildMenu:function(n,t,i){var r,f;menuBuilder.addMenuButton("Home",function(){navigation.entryPoint()});t!=null&&menuBuilder.addMenuButton("<<",function(){menuBuilder.clearNode("menuDiv");menuBuilder.clearNode("viewsMenu");siteMenu.buildMenu(n,i)});r=n;t!=null&&(r=siteMenu.findMenu(t,n));for(f in r){var s=f,u=r[f],o=u.Name,e=function(n){return function(){siteMenu.executeUIAction(n)}}(u.Event);u.Event==null&&(e=function(i){return function(){menuBuilder.clearNode("menuDiv");siteMenu.buildMenu(n,i.Id,t)}}(u));menuBuilder.addMenuButton(o,e)}},processEvent:function(n,t,i,r){var u={Data:t||"",ActionId:i};u=JSON.stringify(u);main.makeWebCall(main.webApiURL+"processEvent/"+n,"POST",siteMenu.processUIActionResponse,u,r)},executeUIAction:function(n,t){var i={Data:t||""};i=JSON.stringify(i);main.makeWebCall(main.webApiURL+"executeUIAction/"+n,"POST",siteMenu.processUIActionResponse,i,t)},processUIActionResponse:function(n,t){var f=n[0],i,r,u,e,o;n.splice(0,1);i=function(){};n.length>0&&(i=function(n){return function(){siteMenu.processUIActionResponse(n,t)}}(n));r=f;u=-1;r!=null&&r.ActionType!=null&&(u=r.ActionType);e=f;switch(u){case-1:inputDialog.showMessage(e,i,null);break;case 0:o=f.ViewData;siteMenu.populateView(o,r,null,t);i();break;case 1:siteMenu.buildInput(r,t);i();break;case 4:inputDialog.cancelInput();i();break;case 5:inputDialog.showMessage(e,i,r.Data);break;case 6:siteMenu.executeUIAction(r.EventNumber,r.ParametersToPass);i();break;default:inputDialog.showMessage("unknown action type: "+u,i,null)}},buildInput:function(n,t){inputDialog.loadInputPage("InputDialog.html",function(){var ft=document.getElementById("pageTitle"),s,v,o,h,l,a,r,it,b,k,rt,c,d,u,e,y,p,g,w,i;ft.innerHTML=n.Description;s=document.createElement("div");s.style.width="100%";s.style.height="100%";document.getElementById("dlgInput").appendChild(s);v=document.createElement("div");v.style.width="100%";v.style.margin="10px";s.appendChild(v);var nt=!1,tt=!1,f=[];for(i=0;i<n.InputFields.length;i++)(r=n.InputFields[i],r.InputType!=2)&&(r.TabName!=null&&r.TabName.length>0?f.indexOf(r.TabName)==-1&&(tt=!0,f.push(r.TabName)):nt=!0);if(tt&&nt&&alert("Error: If tab names are used, all input fields should have tab names"),f.length==0,f.length>0)for(u=0;u<f.length;u++)o=document.createElement("div"),o.id="TabDiv"+u,o.setAttribute("tabName",f[u]),console.log("setting attribute tabName: "+f[u]),h=document.createElement("button"),h.style.marginRight="10px",h.id="TabButton"+u,h.innerHTML=f[u],h.onclick=function(n){return function(){for(var i,r,t=0;t<f.length;t++)i=document.getElementById("TabDiv"+t),r=document.getElementById("TabButton"+t),i.style.display=t==n?"block":"none",r.disabled=t==n}}(u),u==0&&(h.disabled=!0),v.appendChild(h),u>0&&(o.style.display="none"),s.appendChild(o);for(l=[],a=function(n){for(var i,t=0;t<l.length;t++)if(i=l[t],i.TriggerInputName==n)return!0;return!1},i=0;i<n.InputFields.length;i++)if(r=n.InputFields[i],r.VisibilityConditions!=null&&r.VisibilityConditions.length>0)for(it=r.InputName,b=0;b<r.VisibilityConditions.length;b++)k=r.VisibilityConditions[b],rt={InputName:it,Condition:k,TriggerInputName:k.ColumnName},l.push(rt);if(c=function(n,t){var r=n.value,f,i,e,u,n;for(n.type=="checkbox"&&(r=n.checked),r=r+"",f=0;f<l.length;f++)if(i=l[f],i.TriggerInputName==t){for(e="_"+i.InputName,u=!0,i.Condition.Comparison==0?u=r===i.Condition.ColumnValue:i.Condition.Comparison==1?u=r!=i.Condition.ColumnValue:i.Condition.Comparison==2?u=r.indexOf(i.Condition.ColumnValue)>-1:alert("Unknown comparison "+i.Condition.Comparison),n=document.getElementById(e);n.tagName!="TR";)n=n.parentNode;if(n.style.display=u?"":"none",u==!0)break}},d=function(t,i){for(var r,s,p,nt,k,l,dt,yt,v,y,rt,ut,h,pt,wt,ft,gt,et,w,ot,ni,st,ht,ct,f,u,d,bt,lt,g,at,vt,ti,o,b=0;b<n.InputFields.length;b++)if(r=n.InputFields[b],r.TabName==null||!(r.TabName.length>0)||r.TabName==i){s=document.createElement("tr");switch(r.InputType){case 0:case 1:f=document.createElement("td");f.innerHTML=r.InputLabel;s.appendChild(f);u=document.createElement("input");r.InputType==1?u.type="password":r.MultiLineText!=null&&r.MultiLineText==!0?(u=document.createElement("textarea"),u.rows=5):u.type="text";u.id="_"+r.InputName;r.DefaultValue!=null&&r.DefaultValue.length>0&&(u.value=r.DefaultValue);a(r.InputName)&&(u.onchange=function(n){return function(){c(this,n)}}(r.InputName));u.onclick=function(){this.select()};o=document.createElement("td");o.appendChild(u);s.appendChild(o);break;case 2:inputDialog.addHiddenField("_"+r.InputName,r.DefaultValue);break;case 3:for(f=document.createElement("td"),f.innerHTML=r.InputLabel,s.appendChild(f),p=document.createElement("select"),a(r.InputName)&&(p.onchange=function(n){return function(){c(this,n)}}(r.InputName)),p.id="_"+r.InputName,nt=r.ListItems,k=0;k<nt.length;k++)h=document.createElement("option"),h.value=nt[k].Key,h.text=nt[k].Value,p.appendChild(h);p.value=r.DefaultValue!=null&&r.DefaultValue.length>0?r.DefaultValue:"";o=document.createElement("td");o.appendChild(p);s.appendChild(o);break;case 4:f=document.createElement("td");f.innerHTML=r.InputLabel;s.appendChild(f);u=document.createElement("input");a(r.InputName)&&(u.onchange=function(n){return function(){c(this,n)}}(r.InputName));u.type="checkbox";u.id="_"+r.InputName;r.DefaultValue!=null&&(u.checked=r.DefaultValue);o=document.createElement("td");o.appendChild(u);s.appendChild(o);break;case 5:f=document.createElement("td");f.innerHTML=r.InputLabel;s.appendChild(f);e.appendChild(s);s=document.createElement("tr");l=document.createElement("table");l.style.fontSize="75%";l.frame="box";l.cellPadding="0";l.style.padding="0";var tt=document.createElement("tr"),it=document.createElement("tr"),ii=document.createElement("tr"),ri=document.createElement("tr"),kt=document.createElement("td");for(kt.innerHTML=r.SelectedItemsLabel,dt=document.createElement("td"),yt=document.createElement("td"),yt.innerHTML=r.AvailableItemsLabel,tt.appendChild(kt),tt.appendChild(dt),tt.appendChild(yt),v=document.createElement("select"),v.multiple=!0,v.id="_"+r.InputName+"_1",v.size=5,v.style.width="100%",y=document.createElement("select"),y.multiple=!0,y.id="_"+r.InputName+"_2",y.size=5,y.style.width="100%",rt=0;rt<r.ListSource.length;rt++){for(ut=r.ListSource[rt],h=document.createElement("option"),h.value=ut.Key,h.text=ut.Value,pt=!1,wt=r.DefaultValue||[],ft=0;ft<wt.length;ft++)if(gt=wt[ft],gt==ut.Key){pt=!0;break}pt?v.appendChild(h):y.appendChild(h)}et=document.createElement("td");et.rowSpan=3;et.appendChild(v);it.appendChild(et);w=document.createElement("td");w.rowSpan=3;ot=document.createElement("button");ot.innerHTML="<<";ot.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",f=document.getElementById(r),i=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(r.InputName);w.appendChild(ot);ni=document.createElement("br");w.appendChild(ni);st=document.createElement("button");st.innerHTML=">>";st.onclick=function(n){return function(){for(var r="_"+n+"_1",u="_"+n+"_2",i=document.getElementById(r),f=document.getElementById(u),t=i.options.length-1;t>=0;t--)i.options[t].selected&&f.appendChild(i.options[t])}}(r.InputName);w.appendChild(st);it.appendChild(w);ht=document.createElement("td");ht.rowSpan=3;ht.appendChild(y);it.appendChild(ht);l.appendChild(tt);l.appendChild(it);l.appendChild(ii);l.appendChild(ri);ct=document.createElement("td");ct.colSpan=3;ct.appendChild(l);s.appendChild(ct);break;case 6:f=document.createElement("td");f.innerHTML=r.InputLabel;s.appendChild(f);u=document.createElement("input");d="_"+r.InputName;u.type="text";u.id=d;r.DefaultValue!=null&&r.DefaultValue.length>0&&(u.value=r.DefaultValue);a(r.InputName)&&(u.onchange=function(n){return function(){c(this,n)}}(r.InputName));Modernizr.inputtypes.date==!0?u.type="date":(MaskedInput({elm:u,format:"YYYY/MM/DD",separator:"/",typeon:"MDY",allowedfx:function(n){return function(t,i){var r=document.getElementById("_"+n).value;switch(i){case 6:return"01".indexOf(t)>-1;case 7:if(r[5]==="1")return"012".indexOf(t)>-1;break;case 9:return"0123".indexOf(t)>-1;case 10:if(r[8]==="3")return"01".indexOf(t)>-1;break;case 7:return"12".indexOf(t)>-1}return!0}}(r.InputName)}),u.onclick=function(){this.select()});o=document.createElement("td");o.appendChild(u);s.appendChild(o);break;case 7:for(f=document.createElement("td"),f.innerHTML=r.InputLabel,s.appendChild(f),u=document.createElement("input"),d="_"+r.InputName,u.type="text",u.id=d,r.DefaultValue!=null&&r.DefaultValue.length>0&&(u.value=r.DefaultValue),a(r.InputName)&&(u.onchange=function(n){return function(){c(this,n)}}(r.InputName)),bt="",lt=0;lt<=10175;lt++)bt+=String.fromCharCode(lt);for(g="/- ",at=r.InputMask,vt=0;vt<g.length;vt++)ti=new RegExp(g[vt],"g"),at=at.replace(ti,"");MaskedInput({elm:u,format:r.InputMask,separator:g,allowed:bt,typeon:at,allowedfx:function(t){return function(i,r){var u=n.InputFields[t],e=document.getElementById("_"+u.InputName).value,f=u.InputMask[r-1];return f=="n"?"0123456789".indexOf(i)>-1:f=="_"||g.indexOf(i)?!0:!1}}(b)});u.onclick=function(){this.select()};o=document.createElement("td");o.appendChild(u);s.appendChild(o);break;default:inputDialog.showMessage("Unknown input type: "+r.InputType);continue}t.appendChild(s)}},f.length>1)for(u=0;u<f.length;u++){var o=document.getElementById("TabDiv"+u),y=o.getAttribute("tabName",y),e=document.createElement("table");e.className="inputTable";d(e);o.appendChild(e)}else e=document.createElement("table"),e.className="inputTable",y="",f.length>0&&(y=f[0]),d(e,y),console.log("adding input table to pagediv:"),console.log(e),s.appendChild(e);for(p=document.createElement("div"),i=0;i<n.InputButtons.length;i++)g=n.InputButtons[i],w=document.createElement("button"),w.style.margin="10px",w.innerHTML=g.Label,w.onclick=function(i,r){return function(){for(var c={},f,e,u,h,s,o=0;o<r.InputFields.length;o++){if(f=r.InputFields[o],f.InputType==5)for(u=[],e=document.getElementById("_"+f.InputName+"_1"),h=e.options,s=0;s<h.length;s++)u.push(h[s].value);else{if(e=document.getElementById("_"+f.InputName),e==null)continue;u=e.value;e.type=="checkbox"&&(u=e.checked)}if(u=u||"",u.length==0&&f.Mandatory==!0){inputDialog.showMessage(f.InputName+" is mandatory");return}c[f.InputName]=u}siteMenu.processEvent(n.Id,c,i,t)}}(g.ActionNumber,n),p.appendChild(w);for(p.style.textAlign="center",p.style.verticalAlign="middle",document.getElementById("dlgInput").appendChild(p),i=0;i<n.InputFields.length;i++){var r=n.InputFields[i],et="_"+r.InputName,ut=document.getElementById(et);(i==0&&setTimeout(function(){document.getElementById("_"+n.InputFields[0].InputName).focus();document.getElementById("_"+n.InputFields[0].InputName).select()},10),ut!=null)&&c(ut,r.InputName)}})},populateView:function(n,t,i){navigation.loadHtmlBody("mainContent","Views.html",function(){var it=views.getTable(),l=document.createElement("tr"),ot=document.getElementById("viewsTitle"),w,e,s,b,rt,a,v,c,y,nt,ft,f,tt,o,et;for(ot.innerHTML=t.Description,e=0;e<t.Columns.length;e++)w=document.createElement("th"),w.innerHTML=t.Columns[e].ColumnLabel,l.appendChild(w);for(it.appendChild(l),f=0;f<n.length;f++){for(l=document.createElement("tr"),e=0;e<t.Columns.length;e++){var r=t.Columns[e],h=document.createElement("td"),u="";if(r.ColumnName!=null&&r.ColumnName.length>0){for(u=n[f],s=r.ColumnName;s.indexOf(".")>-1;)b=s.indexOf("."),rt=s.substring(0,b),u=u[rt],s=s.substring(b+1);u=u[s]}if(r.ColumnType==1?(u==!0?u=r.TrueValueDisplay:u==!1&&(u=r.FalseValueDisplay),h.innerHTML=u):r.ColumnType==2?(o=document.createElement("button"),o.onclick=function(i,r){return function(){var o=n[i].Id,f=JSON.stringify(n[i]),u=t.Columns[r],e;u.Event.ActionType==5?inputDialog.showMessage(u.Event,null,f):u.Event.ActionType==6?(e=u.Event.EventNumber,f=n[i].Id,siteMenu.executeUIAction(e,f)):inputDialog.showMessage("Unknown action type "+u.Event.ActionType)}}(f,e),r.ButtonTextSource==0?o.innerHTML=r.ButtonText:(inputDialog.showMessage("Unhandled ButtonTextSource: "+r.ButtonTextSource),o.innerHTML="????"),h.appendChild(o)):r.ColumnType==3?(a=document.createElement("a"),a.href="#",a.innerHTML=r.LinkLabel,a.onclick=function(t,i){return function(){var r={Id:n[i][t.KeyColumn]},u=t.EventNumber;siteMenu.executeUIAction(u,r)}}(r,f),h.appendChild(a)):(u=u||"",u=u.toString(),u=u.replace(/\r/g,","),u=u.replace(/\n/g,","),h.innerHTML=u),r.ColumnSetting!=null&&r.ColumnSetting.ColumnSettingType==0){for(v=r.ColumnSetting.Display==0,c=!0,y=0;y<r.ColumnSetting.Conditions.length;y++){var k=r.ColumnSetting.Conditions[y],s=k.ColumnName,d=k.Comparison,ut=k.ColumnValue,p=n[f][s]||"";p=p.toString();d==0?c=c&&p==ut:d==1?c=c&&p!=ut:alert("Unknown comparison: "+d)}if(c==!1&&v==!0||c==!0&&v==!1){var v=r.ColumnSetting.Display==0,st=h.innerHTML,g=document.createElement("div");g.innerHTML=st;nt=document.createElement("td");nt.appendChild(g);g.style.display="none";h=nt}}l.appendChild(h)}it.appendChild(l)}for(ft=document.getElementById("viewsMenu"),menuBuilder.clearNode("viewsMenu"),f=0;f<t.ViewMenu.length;f++)tt=t.ViewMenu[f],o=document.createElement("button"),o.innerHTML=tt.Label,o.onclick=function(n,i){return function(){var r=t.ViewMenu[i];siteMenu.executeUIAction(n,r.ParametersToPass)}}(tt.EventNumber,f),ft.appendChild(o);et=document.getElementById("viewsFooter");et.innerHTML=t.ViewMessage!=null&&t.ViewMessage.length>0?t.ViewMessage:"";i&&i()})}};
var views={getTable:function(){return document.getElementById("tblView")}};
